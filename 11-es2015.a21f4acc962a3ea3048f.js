(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"+qQs":function(t,e,i){"use strict";i.d(e,"a",function(){return a});var s=i("KCVW"),r=i("8Y7J"),n=i("ZXVw"),o=i("XNiG");i("fYS1");const h=(t,e)=>i=>null==i.value?null:t&&i.value>t||e&&i.value<e?{rangeError:{given:i.value,max:t,min:e}}:null,a=(()=>{class t extends n.b{constructor(e,i,s,n,h,a,l,c){super(c,a,l,n),this.dejaTextMetricsService=e,this.elementRef=i,this.changeDetectorRef=s,this.ngControl=n,this.fm=h,this.id=`deja-numeric-stepper-${t.nextId++}`,this.describedBy="",this.controlType="deja-numeric-stepper",this.errorState=!1,this.size=0,this.stateChanges=new o.a,this.focused=!1,this.step=1,this.textChange=new r.EventEmitter,this._required=!1,this._disabled=null,this.onTouchedCallback=(()=>{}),this.onChangeCallback=(()=>{}),this.onValidatorChangeCallback=(()=>{}),this.ngControl&&(this.ngControl.valueAccessor=this),this.fm.monitor(i.nativeElement,!0).subscribe(t=>{this.focused=!!t,this.focused||this.onTouchedCallback(),this.stateChanges.next()})}get shouldLabelFloat(){return this.focused||!this.empty||this.alwaysDisplayUnit}set inputValidatorDirective(t){t&&(t.parentControl=this.ngControl)}get placeholder(){return this._placeholder}set placeholder(t){this._placeholder=t,this.stateChanges.next()}get alwaysDisplayUnit(){return this._alwaysDisplayUnit}set alwaysDisplayUnit(t){this._alwaysDisplayUnit=Object(s.b)(t)}get empty(){return!this._value&&0!==this._value}set disabled(t){const e=Object(s.b)(t);this._disabled=e||null,this.changeDetectorRef.markForCheck()}get required(){return this._required}set required(t){this._required=Object(s.b)(t),this.stateChanges.next()}get disabled(){return this.ngControl?this.ngControl.disabled:this._disabled}ngOnChanges(t){(t.min||t.max)&&(this.validateFn=h(this.max,this.min),this.ngControl&&this.ngControl.control&&this.ngControl.control.setValidators(this.validateFn))}ngDoCheck(){this.ngControl&&this.updateErrorState()}validate(t){return this.validateFn(t)}ngOnDestroy(){this.stateChanges.complete(),this.fm.stopMonitoring(this.elementRef.nativeElement)}setDescribedByIds(t){this.describedBy=t.join(" ")}onContainerClick(t){"input"!==t.target.tagName.toLowerCase()&&this.elementRef.nativeElement.querySelector("input").focus()}get value(){return this._value}set value(t){this.writeValue(t),this.onChangeCallback(t),this.onTouchedCallback(),this.stateChanges.next()}writeValue(t){this._value=null==t?t:isNaN(t)?null:+t,this.checkSize(t),this.changeDetectorRef.markForCheck(),this.textChange.emit(t)}registerOnChange(t){this.onChangeCallback=t}registerOnTouched(t){this.onTouchedCallback=t}setDisabledState(t){this.disabled=t}checkSize(t){this.size=this.dejaTextMetricsService.getTextWidth((t||this.value||0).toString(),this.elementRef.nativeElement)}}return t.nextId=0,t})()},"1WO2":function(t,e,i){"use strict";i.d(e,"a",function(){return l});var s=i("fYS1"),r=i("Cfvw"),n=i("pLZG"),o=i("GJmQ"),h=i("SxV6"),a=i("1G5W");i("qF2d");class l{constructor(t,e){this.isAlive=!0;const i=t.nativeElement,l=Object(r.a)(e.dragging$),c=l.pipe(Object(n.a)(t=>!t));l.pipe(Object(o.a)(()=>this.isAlive),Object(n.a)(t=>t)).subscribe(()=>{c.pipe(Object(h.a)()).subscribe(()=>{this._dragContext&&(this.context&&this.context.drop&&this.context.drop(this._dragContext),this._dragContext=void 0),e.dropCursor$.next(void 0)}),Object(r.a)(e.dragCursor$).pipe(Object(a.a)(c)).subscribe(t=>{const r=new s.m(i.getBoundingClientRect());if(this.context&&t){const{pageX:i,pageY:n}=t.originalEvent;if(r.containsPoint(new s.l(i,n))){if(this._dragContext){if(this.context.dragOver){const i=this.context.dragOver(this._dragContext,t);i&&e.dropCursor$.next(i)}}else if(this._dragContext=e.context,this.context.dragEnter){const i=this.context.dragEnter(this._dragContext,t);if(i){const t=i;if(t.subscribe)return void t.pipe(Object(h.a)()).subscribe(t=>{e.dropCursor$.next(t)});e.dropCursor$.next(i)}}}else this._dragContext&&(this.context&&this.context.dragLeave&&this.context.dragLeave(this._dragContext),this._dragContext=void 0,e.dropCursor$.next(void 0))}})})}set context(t){this._context=t}get context(){return this._context}ngOnDestroy(){this.isAlive=!1}}},DMiE:function(t,e,i){"use strict";i.d(e,"a",function(){return p});var s=i("KCVW"),r=i("8Y7J"),n=(i("7lvT"),i("MPFR"),i("fYS1")),o=i("XNiG"),h=i("Cfvw"),a=i("PqYM"),l=i("GJmQ"),c=i("pLZG"),d=i("Kj3r"),u=i("ja5E"),g=i("Fp2t");class p{constructor(t,e){this.changeDetectorRef=t,this.dejaPopupService=e,this.edit$=new o.a,this.editorConfig=p.buildEditorConfig(),this.foregroundColor=null,this.backgroundColor=null,this.borderTop=null,this.borderRight=null,this.borderBottom=null,this.borderLeft=null,this.close=new r.EventEmitter,this.modelChanged=new r.EventEmitter,this.editing=!1,this.isAlive=!0,this.subscriptions=[],this._designMode=!1,Object(h.a)(this.edit$).pipe(Object(l.a)(()=>this.isAlive),Object(c.a)(()=>this._designMode),Object(d.a)(100)).subscribe(()=>{this.editor&&this.editor.setFocus()})}set model(t){this._model=t,this.updateColorsFromModel(),this.updateBorderFromModel(),this.subscriptions.forEach(t=>t.unsubscribe()),this.subscriptions=[],t&&this.subscriptions.push(Object(h.a)(this._model.refresh$).pipe(Object(l.a)(()=>this.isAlive&&!!this._model),Object(d.a)(1)).subscribe(()=>{this.updateColorsFromModel(),this.updateBorderFromModel(),this.modelChanged.emit(this.model)}))}get model(){return this._model}get designMode(){return this._designMode}set designMode(t){this._designMode=Object(s.b)(t),this.editing=!1,this.changeDetectorRef.markForCheck()}static buildEditorConfig(){return{coreStyles_bold:{element:"b",overrides:"strong"},coreStyles_italic:{element:"i",overrides:"em"},enterMode:3,extraPlugins:"colorbutton,justify,autogrow",language:"fr",format_tags:"p;h1;h2",removeButtons:"Styles,Subscript,Superscript,Strike",removePlugins:"magicline",toolbarGroups:[{name:"undo"},{name:"align"},{name:"colors"},{name:"font"},"/",{name:"others"},{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"styles",groups:["format","formats"]},{name:"paragraph",groups:["list"]}]}}ngOnDestroy(){this.isAlive=!1,this.subscriptions.forEach(t=>t.unsubscribe())}edit(){this.designMode&&(this.editing=!0,this.changeDetectorRef.markForCheck(),Object(a.a)(100).subscribe(()=>{this.editor&&this.editor.setFocus()}))}onEditorBlur(){this.editing=!1,this.changeDetectorRef.markForCheck()}editStyle(){const t=new u.a;t.data={borderWidth:this.model.borderWidth,borderColor:this.model.borderColor,borderDirection:this.model.borderDirection,update:(t,e,i)=>{this.model.borderWidth=t,this.model.borderColor=e,this.model.borderDirection=i,this.updateBorderFromModel()}};const e={borderColor:this.model.borderColor,borderWidth:this.model.borderWidth,borderDirection:this.model.borderDirection};this.dejaPopupService.openAdvanced$(t).subscribe(t=>{t.accepted?0!==this.model.borderDirection&&0!==this.model.borderWidth||(this.model.clearBorder(),this.updateBorderFromModel()):(this.model.borderColor=e.borderColor,this.model.borderDirection=e.borderDirection,this.model.borderWidth=e.borderWidth,this.updateBorderFromModel()),t.accepted&&this.modelChanged.emit(this.model)})}updateColorsFromModel(){this.foregroundColor=this._model?n.b.parse(this._model.color).bestTextColor.toHex():null,this.backgroundColor=this._model?this._model.color:null,this.changeDetectorRef.markForCheck()}updateBorderFromModel(){this._model?(this.borderTop=0!=(this._model.borderDirection&g.a.top)?`solid ${this._model.borderColor||"transparent"} ${this._model.borderWidth||0}px`:null,this.borderRight=0!=(this._model.borderDirection&g.a.right)?`solid ${this._model.borderColor||"transparent"} ${this._model.borderWidth||0}px`:null,this.borderBottom=0!=(this._model.borderDirection&g.a.bottom)?`solid ${this._model.borderColor||"transparent"} ${this._model.borderWidth||0}px`:null,this.borderLeft=0!=(this._model.borderDirection&g.a.left)?`solid ${this._model.borderColor||"transparent"} ${this._model.borderWidth||0}px`:null):(this.borderTop=null,this.borderRight=null,this.borderBottom=null,this.borderLeft=null),this.changeDetectorRef.markForCheck()}}},Fp2t:function(t,e,i){"use strict";i.d(e,"a",function(){return n}),i.d(e,"b",function(){return o});var s=i("fYS1"),r=i("UMfw"),n=function(t){return t[t.top=1]="top",t[t.right=2]="right",t[t.bottom=4]="bottom",t[t.left=8]="left",t[t.all=15]="all",t}({});class o extends r.a{constructor(t){super(t),this.color="rgb(38, 50, 56)",this.clearBorder()}get idealBounds(){return new s.m(0,0,15,5)}clearBorder(){this.borderDirection=n.all,this.borderWidth=0,this.borderColor="#000"}clone(t){return t||(t=new o),super.clone(t),t.html=this.html,t.borderWidth=this.borderWidth,t.borderColor=this.borderColor,t.borderDirection=this.borderDirection,t}}},JyZx:function(t,e,i){"use strict";i.d(e,"a",function(){return d});var s=i("8Y7J"),r=i("Cfvw"),n=i("pLZG"),o=i("SxV6"),h=i("vkgz"),a=i("3E0/"),l=i("Kj3r"),c=i("Fp2t");i("UMfw");class d{constructor(t,e){this.changeDetectorRef=e,this.groupChanged=new s.EventEmitter,this.close=new s.EventEmitter,this.progressDiameter=100,this.subscriptions=[],this.element=t.nativeElement,this.element.setAttribute("hidden","0")}set tile(t){if(this._tile=t,this.subscriptions.forEach(t=>t.unsubscribe()),this.subscriptions=[],t){const e=(t,e)=>{e?this.element.setAttribute(t,e.toString()):this.element.removeAttribute(t)};t.fading&&(this.element.setAttribute("fading","0"),this.changeDetectorRef.markForCheck()),this.subscriptions.push(Object(r.a)(t.pixelBounds$).pipe(Object(n.a)(t=>!!t),Object(o.a)(),Object(n.a)(()=>t.fading),Object(h.a)(()=>{this.element.setAttribute("fading","1"),this.changeDetectorRef.markForCheck()}),Object(a.a)(200)).subscribe(()=>{this.element.removeAttribute("fading"),this.changeDetectorRef.markForCheck()})),this.subscriptions.push(Object(r.a)(t.pixelBounds$).pipe(Object(n.a)(t=>!!t)).subscribe(e=>{t.isHidden||this.element.removeAttribute("hidden"),this.element.style.left=`${e.left+4}px`,this.element.style.top=`${e.top+4}px`,this.element.style.width=`${e.width-8}px`,this.element.style.height=`${e.height-8}px`,this.progressDiameter=Math.min(100,Math.round(Math.max(.4*e.width,.4*e.height))),this.changeDetectorRef.markForCheck()})),this.subscriptions.push(Object(r.a)(t.pressed$).pipe(Object(h.a)(t=>e("pressed",t))).subscribe(()=>this.changeDetectorRef.markForCheck())),this.subscriptions.push(Object(r.a)(t.selected$).pipe(Object(h.a)(t=>e("selected",t))).subscribe(()=>this.changeDetectorRef.markForCheck())),this.subscriptions.push(Object(r.a)(t.dragging$).pipe(Object(h.a)(t=>e("drag",t))).subscribe(()=>this.changeDetectorRef.markForCheck())),this.subscriptions.push(Object(r.a)(t.dropping$).pipe(Object(h.a)(t=>e("drop",t))).subscribe(()=>this.changeDetectorRef.markForCheck())),this.subscriptions.push(Object(r.a)(t.cutted$).pipe(Object(h.a)(t=>e("cutted",t))).subscribe(()=>this.changeDetectorRef.markForCheck())),this.subscriptions.push(Object(r.a)(t.expanded$).pipe(Object(h.a)(t=>e("expanded",t))).subscribe(()=>this.changeDetectorRef.markForCheck())),this.subscriptions.push(Object(r.a)(t.deleted$).pipe(Object(h.a)(()=>this.element.remove())).subscribe(()=>this.changeDetectorRef.markForCheck()));const i=Object(r.a)(t.hidden$).pipe(Object(h.a)(t=>e("hidden",t?"1":"2")));this.subscriptions.push(i.pipe(Object(l.a)(1e3),Object(n.a)(t=>t),Object(h.a)(()=>this.element.setAttribute("hidden","0"))).subscribe(()=>this.changeDetectorRef.markForCheck())),this.subscriptions.push(i.pipe(Object(l.a)(1),Object(n.a)(t=>!t),Object(h.a)(()=>this.element.removeAttribute("hidden"))).subscribe(()=>this.changeDetectorRef.markForCheck())),this.subscriptions.push(Object(r.a)(t.refresh$).pipe(Object(l.a)(1)).subscribe(()=>this.changeDetectorRef.markForCheck()))}}get tile(){return this._tile}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe())}onGroupChanged(t){this.groupChanged.emit(t)}get isGroup(){return this._tile&&this._tile instanceof c.b}}},KVC5:function(t,e,i){"use strict";i.d(e,"a",function(){return l});var s=i("2Vo4"),r=i("Cfvw"),n=i("GJmQ"),o=i("pLZG"),h=i("vkgz"),a=i("3E0/");i("qF2d");class l{constructor(t,e){this.dragDropService=e,this.position$=new s.a(void 0),this.cursor$=new s.a(void 0),this.isAlive=!0;const i=t.nativeElement;Object(r.a)(this.position$).pipe(Object(n.a)(()=>this.isAlive)).subscribe(t=>{i.style.left=t?`${t.left}px`:"-1000px",i.style.top=t?`${t.top}px`:"-1000px"});const l=Object(r.a)(this.cursor$);l.pipe(Object(n.a)(()=>this.isAlive),Object(o.a)(t=>!t),Object(h.a)(t=>{this._currentCursor&&this.contentElement&&this.iconElement&&(this.contentElement.style.opacity="0",this.iconElement.style.opacity="0"),this._currentCursor=t}),Object(a.a)(300)).subscribe(()=>{this.position$.next(null),i.style.display="none"}),l.pipe(Object(n.a)(()=>this.isAlive),Object(o.a)(t=>!!t),Object(h.a)(t=>{i.style.display="",this.contentElement&&this.iconElement&&(this.contentElement.style.opacity="0",this.iconElement.style.opacity="0"),this._currentCursor=t}),Object(o.a)(t=>!t.className||"hidden"!==t.className),Object(h.a)(t=>{t.html?(i.className=t.className,this.contentElement&&this.iconElement&&(this.contentElement.innerHTML=t.html,this.contentElement.style.width=`${t.width||48}px`,this.contentElement.style.height=`${t.height||48}px`)):this.iconElement&&(this.iconElement.style.opacity="1")}),Object(a.a)(1)).subscribe(t=>{t.html&&this.contentElement&&(this.contentElement.style.opacity="1")}),Object(r.a)(this.dragDropService.dragCursor$).pipe(Object(n.a)(()=>this.isAlive)).subscribe(t=>{!!t!=!!this._dragCursor&&(this._dragCursor=t),this._dropCursor&&this._dragCursor&&(t.className=this._dropCursor.className||this._dragCursor.className,t.html=this._dropCursor.html||this._dragCursor.html,t.width=this._dropCursor.width||this._dragCursor.width,t.height=this._dropCursor.height||this._dragCursor.height),!!t!=!!this._currentCursor||t&&!!t.html!=!!this._currentCursor.html?this.cursor$.next(t):t&&this.position$.next(t.position)}),Object(r.a)(this.dragDropService.dropCursor$).pipe(Object(n.a)(()=>this.isAlive)).subscribe(t=>{this._dropCursor=t})}get iconElement(){return this.icon.nativeElement}get contentElement(){return this.content.nativeElement}ngOnDestroy(){this.isAlive=!1}}},SsaN:function(t,e,i){"use strict";i.d(e,"a",function(){return C});var s=i("fYS1"),r=i("XNiG"),n=i("2Vo4"),o=i("Cfvw"),h=i("VRyK"),a=i("xgIS"),l=i("PqYM"),c=i("Kj3r"),d=i("GJmQ"),u=i("vkgz"),g=i("3E0/"),p=i("lJxs"),b=i("pLZG"),m=i("1G5W"),f=i("IzEk"),v=i("SxV6"),x=i("128B");class C{constructor(t){this.clipboardService=t,this.refreshTiles$=new r.a,this.ensureVisible$=new r.a,this.ensureBounds$=new r.a,this.dragging$=new n.a(!1),this.dragSelection$=new r.a,this.dragDropInfos$=new r.a,this.selectionRect$=new r.a,this.dragover$=new r.a,this.dragleave$=new r.a,this.deleteTiles$=new r.a,this.designMode=!1,this.layoutCompleted=new r.a,this.layoutChanged=new r.a,this.tilesAdded=new r.a,this.tilesDeleted=new r.a,this.selectionChanged=new r.a,this.contentAdding=new r.a,this.contentRemoving=new r.a,this._tileMinWidth=10,this._tileMinWidthUnit="%",this._tileMaxWidth=100,this._tileMaxWidthUnit="%",this._tileMinHeight=10,this._tileMinHeightUnit="%",this._tileMaxHeight=100,this._tileMaxHeightUnit="%",this._maxWidth=100,this._maxWidthUnit="%",this.tilesDic={},this._targetBounds={},this.destination={},this.dragPageOffset={},this.dragOriginalPosition={},this.isAlive=!0,this.selectedIds=[],Object(o.a)(this.refreshTiles$).pipe(Object(c.a)(30),Object(d.a)(()=>this.isAlive),Object(u.a)(()=>{this.container.style.width="",this.container.style.height=""}),Object(g.a)(10),Object(d.a)(()=>this.isAlive)).subscribe(t=>{const e=[],i=this.container.getBoundingClientRect();(t&&t.resetWidth||!this.hundredPercentWith)&&(this.hundredPercentWith=i.width);let r=i.height-20,n=i.width-20,o=0,h=0;const a=this.tiles||[],l=[];a.forEach(t=>{if(t.percentBounds&&!t.percentBounds.isEmpty()){const e=this.getPixelBounds(t.percentBounds);e.bottom>o&&(o=e.right),e.right>h&&(h=e.bottom),t.isDragging||(t.pixelBounds=e)}else e.push(t);t.isSelected&&!t.isHidden&&l.push(t.id),t.pixelBounds&&t.pixelBounds.bottom>r&&(r=t.pixelBounds.bottom)});let c=h,d=0;if(e.forEach(t=>{t.percentBounds=t.percentBounds||new s.m(this.getPercentSize(d),this.getPercentSize(c),3*this.getTileMinPercentWidth(),3*this.getTileMinPercentHeight());let e=this.getPixelBounds(t.percentBounds);e.right>n&&(c=h,d=0,t.percentBounds.left=0,t.percentBounds.top=this.getPercentSize(c),e=this.getPixelBounds(t.percentBounds)),e.bottom>h&&(h=e.bottom),t.pixelBounds=this.getPixelBounds(t.percentBounds),d+=e.width}),this.dragTarget){const t=this.getPixelBounds(this.dragTarget);r<=t.bottom&&(r=t.bottom+t.height),n<=t.right&&(n=t.right+t.width)}const u=this.getPixelSize(2*this._tileMinHeight,this._tileMinHeightUnit);r<u&&(r=u),this.container.style.width=`${n}px`,this.container.style.height=`${r}px`,t&&(t.ensureVisible&&this.ensureVisible$.next(t.ensureVisible),t.ensureBounds&&this.ensureBounds$.next(t.ensureBounds)),this.selectedTiles=l;const g=new CustomEvent("DejaTilesEvent",{cancelable:!1});e.length>0&&(g.tiles=e,this.layoutChanged.next(g)),g.tiles=a,this.layoutCompleted.next(g)});const e=Object(o.a)(this.ensureVisible$).pipe(Object(g.a)(1),Object(p.a)(t=>this.tilesDic[t]),Object(b.a)(t=>!!t),Object(p.a)(t=>t.percentBounds));Object(h.a)(this.ensureBounds$,e).pipe(Object(d.a)(()=>this.isAlive)).subscribe(t=>{const{left:e,right:i,top:s,bottom:r}=this.getPixelBounds(t),n=(t=>{for(;t&&"DEJA-TILES"!==t.tagName;)t=t.parentElement;return t})(this.container);if(!n)return;const o=this.container.getBoundingClientRect(),h=n.getBoundingClientRect();e+o.left<h.bottom?n.scrollLeft+=e+o.left-h.bottom:i+o.left>h.right&&(n.scrollLeft+=i+o.left-h.right),s+o.top<h.top?n.scrollTop+=s+o.top-h.top:r+o.top>h.bottom&&(n.scrollTop+=r+o.top-h.bottom)}),Object(o.a)(this.dragSelection$).pipe(Object(d.a)(()=>this.isAlive)).subscribe(t=>{const e=Object(a.a)(this._container.ownerDocument,"mouseup").pipe(Object(u.a)(()=>this.selectionRect$.next(null)));Object(a.a)(this._container,"mousemove").pipe(Object(m.a)(e),Object(b.a)(t=>1===t.buttons)).subscribe(e=>{const i=this._container.getBoundingClientRect();t.selectedRect=s.m.fromPoints(t.startPosition,new s.l(e.pageX-i.left,e.pageY-i.top)),this.selectionRect$.next(t.selectedRect);const r=this.HitTest(t.selectedRect);this.selectedTiles=r.map(t=>t.id)})});const i=Object(o.a)(this.dragleave$);Object(o.a)(this.dragDropInfos$).pipe(Object(d.a)(()=>this.isAlive)).subscribe(t=>{if(!t||!t.tiles||!t.tiles.length)return;const e=Object(a.a)(this._container,"mousemove"),r=Object(a.a)(this._container.ownerDocument,"mouseup"),n=Object(a.a)(this._container.ownerDocument,"keyup").pipe(Object(b.a)(t=>t.keyCode===s.j.Escape)),l=Object(h.a)(i,e.pipe(Object(b.a)(t=>1!==t.buttons)),n),c=Object(h.a)(r,l);let d;const g=l.pipe(Object(f.a)(1),Object(u.a)(()=>d.unsubscribe())).subscribe(()=>{this.removeTemporaryTile(),this.cancelDrag(t.tiles)});d=r.pipe(Object(f.a)(1),Object(u.a)(()=>g.unsubscribe())).subscribe(()=>this.drop(t.tiles));const v=Object(o.a)(this.dragover$).pipe(Object(p.a)(t=>t.originalEvent));Object(h.a)(e,v).pipe(Object(m.a)(c)).subscribe(e=>{const i=this._container.getBoundingClientRect(),r=e.pageX-i.left,n=e.pageY-i.top;if(t.enabled)this.drag(t.tiles,r,n);else if(Math.abs(t.startX-r)>=10||Math.abs(t.startY-n)>=10)if(1!==t.tiles.length||this.tiles.find(e=>e===t.tiles[0]))this.dragging$.next(!0),t.enabled=!0,this.startDrag(t.tiles,r,n);else{const e=t.tiles[0];this.selectedTiles=[e.id];let i=e.percentBounds;i&&!i.isEmpty()||(i=new s.m(0,0,15,15));const o=this.getFreePlace(new s.m(this.getPercentSize(r)-i.width/2,this.getPercentSize(n)-i.height/2,i.width,i.height));t.startX=o.left-i.width/2,t.startY=o.top-i.height/2,e.percentBounds=o,e.dragging$.next(!0),this._cursor="move",this.tiles.push(e),this.tilesDic[e.id]=e,this.dragging$.next(!0),t.enabled=!0,this.startDrag(t.tiles,this.getPixelSize(o.left+o.width/2),this.getPixelSize(o.top+o.height/2))}})}),Object(o.a)(this.deleteTiles$).pipe(Object(d.a)(()=>this.isAlive)).subscribe(t=>this.deleteTiles(t))}set container(t){if(this._container=t,this._container){const e=Object(a.a)(t,"mouseleave"),i=Object(a.a)(t.ownerDocument,"mouseup");Object(a.a)(t,"mouseenter").pipe(Object(d.a)(()=>this.isAlive)).subscribe(()=>{this.designMode?Object(a.a)(t,"mousemove").pipe(Object(c.a)(10),Object(m.a)(e),Object(b.a)(t=>!!this.container&&0===t.buttons)).subscribe(t=>{this._cursor=this.getCursorFromHTMLElement(t.pageX,t.pageY,t.target),this.container.style.cursor=this._cursor}):this.container.style.cursor="",Object(a.a)(t,"mousedown").pipe(Object(b.a)(t=>1===t.buttons),Object(b.a)(t=>!this.isElementInsideDejaEditor(t.target)),Object(p.a)(t=>({event:t,target:t.target,clickedTile:this.getTileComponentFromHTMLElement(t.target)}))).pipe(Object(m.a)(e)).subscribe(({event:t,target:r,clickedTile:n})=>{if(this.currentTile&&(this.currentTile.isPressed=!1),this.currentTile=n,this.currentTile){if(this.currentTile.isPressed=!0,t.ctrlKey);else if(this.currentTile.isSelected&&"move"===this._cursor||(this.selectedTiles=[this.currentTile.id]),this.designMode){const e=this._container.getBoundingClientRect();this.dragDropInfos$.next({enabled:!1,startX:t.pageX-e.left,startY:t.pageY-e.top,tiles:this.tiles.filter(t=>t.isSelected)})}Object(h.a)(i,e).pipe(Object(v.a)(),Object(b.a)(()=>!!this.currentTile)).subscribe(t=>{this.currentTile.isPressed&&(this.currentTile.isPressed=!1,t.ctrlKey&&(this.currentTile.isSelected=!this.currentTile.isSelected,this.selectedTiles=this.tiles.filter(t=>t.isSelected).map(t=>t.id))),this.currentTile=void 0})}else if(r===this.container||r.parentElement===this.container){if(1===t.buttons){const e=this._container.getBoundingClientRect();this.dragSelection$.next({startPosition:new s.l(t.pageX-e.left,t.pageY-e.top),selectedRect:new s.m})}this.currentTile&&(this.currentTile.isPressed=!1),this.selectedTiles=[]}})})}}get container(){return this._container}set tiles(t){this._tiles=t,this.tilesDic=this.tiles.reduce((t,e)=>(t[e.id]=e,t),{}),this.refreshTiles$.next({resetWidth:!0})}get tiles(){return this._tiles||(this._tiles=[])}set selectedTiles(t){const e=[];let i=!1;const s=t.reduce((t,e)=>(t[e]=!0,t),{}),r=this.selectedIds.reduce((t,e)=>(t[e]=!0,t),{});if(this.tiles&&this.tiles.length?this.tiles.forEach(t=>{s[t.id]!==r[t.id]&&(i=!0),t.isSelected=s[t.id],t.isSelected&&e.push(t)}):i=this.selectedIds.length>0,this.selectedIds=t,i){const t=new CustomEvent("DejaTilesAddEvent",{cancelable:!1});t.tiles=e,this.selectionChanged.next(t)}}set tileMinWidth(t){this.extractValueAndUnit("_tileMinWidth",t)}set tileMaxWidth(t){this.extractValueAndUnit("_tileMaxWidth",t)}set tileMinHeight(t){this.extractValueAndUnit("_tileMinHeight",t)}set tileMaxHeight(t){this.extractValueAndUnit("_tileMaxHeight",t)}set maxWidth(t){this.extractValueAndUnit("_maxWidth",t)}get targetBounds(){return this._targetBounds}set targetBounds(t){this._targetBounds=t,t?this.selectionRect$.next(new s.m({height:this.getPixelSize(t.height||0),left:this.getPixelSize(t.left||0),top:this.getPixelSize(t.top||0),width:this.getPixelSize(t.width||0)})):this.selectionRect$.next()}ngOnDestroy(){this.isAlive=!1,this._container=void 0}copySelection(){const t=this.tiles.filter(t=>t.isSelected);return t.length&&this.copyTiles(t,!1),t}cutSelection(){const t=this.tiles.filter(t=>t.isSelected);return t.length&&this.copyTiles(t,!0),t}deleteSelection(){const t=this.tiles.filter(t=>t.isSelected);return t.length&&this.removeTiles(t.map(t=>t.id)),t}paste(){if(!this.clipboardService||!this.clipboardService.isAvailable("tiles"))return[];const t=this.clipboardService.get("tiles");let e;this.tiles.forEach(t=>t.isSelected=!1),t.forEach(t=>{e=e?s.m.union(e,t.percentBounds):new s.m(t.percentBounds)});const i=this.getFreePlace(new s.m(0,0,e.width,e.height)),r=t.map(t=>{const r=t.clone();return r.percentBounds=new s.m(i.left+t.percentBounds.left-e.left,i.top+t.percentBounds.top-e.top,t.percentBounds.width,t.percentBounds.height),r.isSelected=!0,r});return this.addTiles(r),r}getTileElementFromHTMLElement(t){let e=t;for(;e&&"DEJA-TILE"!==e.tagName;)if((e=e.parentElement)===this.container)return;return e}isElementInsideDejaEditor(t){let e=t;for(;e&&e!==this.container;){if("DEJA-EDITOR"===e.tagName)return!0;e=e.parentElement}return!1}getTileComponentFromHTMLElement(t){const e=this.getTileElementFromHTMLElement(t);return e&&this.tilesDic[e.id]}deleteTiles(t){if(!t||0===t.length)return;const e=new CustomEvent("DejaTilesDeletedEvent",{cancelable:!1});e.tiles=t,t.forEach(t=>{delete this.tilesDic[t.id],t.delete()});let i=this.tiles.length;for(;--i>=0;)this.tilesDic[this.tiles[i].id]||this.tiles.splice(i,1);this.refreshTiles$.next({resetWidth:!0}),e.tiles=this.tiles,this.tilesDeleted.next(e)}removeTiles(t){if(!t||0===t.length)return;const e=t.map(t=>this.tilesDic[t]);e.forEach(t=>{t.isHidden=!0});const i=new CustomEvent("DejaTilesRemoveEvent",{cancelable:!0});i.tiles=this.tiles,i.removed=e,i.cancel$=new r.a;const s=i.cancel$.pipe(Object(v.a)()).subscribe(t=>{t?e.forEach(t=>t.isHidden=!1):this.deleteTiles(e)});this.contentRemoving.next(i),i.defaultPrevented||(s.unsubscribe(),this.deleteTiles(e))}getFreePlace(t){const e=[];let i=0;this.tiles.forEach(t=>{t.percentBounds.bottom>i&&(i=t.percentBounds.bottom)});for(let r=0;r<=this._maxWidth-t.width;r+=this._tileMinWidth)for(let n=0;n<=i-t.height;n+=this._tileMinHeight){const i=new s.m(r,n,t.width,t.height);0===this.tiles.filter(t=>t.percentBounds.intersectWith(i)).length&&e.push(i)}return e.length>0?(e.sort((e,i)=>{const s=e=>Math.min(Math.abs(e.left-t.left),Math.abs(e.right-t.right))+200*Math.min(Math.abs(e.top-t.top),Math.abs(e.bottom-t.bottom));return s(e)-s(i)}),e[0]):new s.m(0,i,t.width,t.height)}moveTile(t,e){const i=this.tiles.find(e=>e.id===t);i&&(i.percentBounds=e,this.refreshTiles$.next())}HitTest(t){const e=new s.m(this.getPercentSize(t.left),this.getPercentSize(t.top),this.getPercentSize(t.width),this.getPercentSize(t.height));return this.tiles.filter(t=>t.percentBounds.intersectWith(e))}getPercentSize(t){return Math.round(100*t/this.hundredPercentWith)}dragEnter(t,e){if(!this.designMode||!this._container)return!1;const i=t.DejaTile;if(!i)return!1;const s=this._container.getBoundingClientRect(),{pageX:r,pageY:n}=e.originalEvent,o=r-s.left,h=n-s.top,a=i.clone();return a.isTemporary=!0,this.dragDropInfos$.next({enabled:!1,startX:o,startY:h,tiles:[a]}),!0}startDrag(t,e,i){const r=this.saveLayout();let n;t.forEach(t=>{n=n?s.m.union(n,t.percentBounds):t.percentBounds,t.isDragging=!0}),this.dragRelativePosition={},t.forEach(t=>{this.dragRelativePosition[t.id]=new s.l(t.percentBounds.left-n.left,t.percentBounds.top-n.top)}),this.dragPageOffset=new s.l(e,i),this.dragOriginalPosition=new s.l(n.left,n.top),this.targetBounds=r.targetBounds=r.validBounds=n,this.originalLayout=r,this.validLayout=void 0}expandTile(t,e){const i=t.id?this.tilesDic[t.id]:this.tiles.find(e=>e.equalsTo(t));this.beforeSizeLayout?this.restoreLayout(this.beforeSizeLayout):this.beforeSizeLayout=this.saveLayout(),this.expandedTile=i,i.isExpanded=!0;const r=Math.ceil(100*e/this.hundredPercentWith);this.size(i,new s.l(0,this.getPixelSize(i.percentBounds.top+r)),s.g.bottom)}cancelExpand(){this.beforeSizeLayout&&(this.expandedTile.isExpanded=!1,this.restoreLayout(this.beforeSizeLayout),this.refreshTiles$.next(),this.beforeSizeLayout=void 0)}cancelDrag(t){this.moveTimOut&&(this.moveTimOut.unsubscribe(),this.moveTimOut=void 0),Object(o.a)(t).pipe(Object(b.a)(t=>!!t),Object(u.a)(t=>{t.isDragging=!1,t.isDropping=!0}),Object(g.a)(1e3)).subscribe(t=>{t.isDropping=!1}),this.originalLayout&&this.restoreLayout(this.originalLayout),this.endDrag()}drop(t){let e;if(this.moveTimOut&&(this.moveTimOut.unsubscribe(),this.moveTimOut=void 0),this.validLayout){if(this.restoreLayout(this.validLayout),"move"!==this._cursor){const e=t[0];e.percentBounds=new s.m(this.validLayout.validBounds),e.isDragging=!1}else Object(o.a)(t).pipe(Object(b.a)(t=>!!t),Object(u.a)(t=>{t.percentBounds=new s.m(this.validLayout.validBounds.left+this.dragRelativePosition[t.id].left,this.validLayout.validBounds.top+this.dragRelativePosition[t.id].top,t.percentBounds.width,t.percentBounds.height),t.isDragging=!1,t.isDropping=!0,t.isTemporary&&(delete this.tilesDic[t.id],t.makeId(),this.tilesDic[t.id]=t,this.addTiles([t]))}),Object(g.a)(1e3)).subscribe(t=>{t.isDropping=!1});e=this.tiles.filter(t=>!s.m.equals(t.percentBounds,this.originalLayout[t.id]&&this.originalLayout[t.id].bounds)),this.endDrag()}else this.removeTemporaryTile(),this.cancelDrag(t);if(e){const t=new CustomEvent("DejaTilesEvent",{cancelable:!0});t.tiles=this.tiles,this.layoutChanged.next(t)}return e}endDrag(){this.originalLayout=void 0,this.validLayout=void 0,this.targetBounds=void 0,this.dragging$.next(!1),this.dragDropInfos$.next(null),this.dragTarget=void 0,this.copyTiles(null),this.refreshTiles$.next()}drag(t,e,i){const r=new s.l(e-this.dragPageOffset.left,i-this.dragPageOffset.top),n=r.left+this.getPixelSize(this.dragOriginalPosition.left),o=r.top+this.getPixelSize(this.dragOriginalPosition.top),h=this.getTileMinPixelSize(),a=this.getTileMaxPixelSize();if("move"!==this._cursor){const e=t[0],i=this.getPixelBounds(e.percentBounds),r=n+i.width,l=o+i.height,c=i.right,d=i.bottom;switch(this._cursor){case"nw-resize":i.left=Math.max(Math.min(n,i.right-h.width),i.right-a.width),i.right=c,i.top=Math.max(Math.min(o,i.bottom-h.height),i.bottom-a.height),i.bottom=d,this.size(e,new s.l(n,o),s.g.left+s.g.top);break;case"sw-resize":i.left=Math.max(Math.min(n,i.right-h.width),i.right-a.width),i.right=c,i.bottom=Math.max(Math.min(l,i.top+a.height),i.top+h.height),this.size(e,new s.l(n,l),s.g.left+s.g.bottom);break;case"w-resize":i.left=Math.max(Math.min(n,i.right-h.width),i.right-a.width),i.right=c,this.size(e,new s.l(n,0),s.g.left);break;case"ne-resize":i.right=Math.max(Math.min(r,i.left+a.width),i.left+h.width),i.top=Math.max(Math.min(o,i.bottom-h.height),i.bottom-a.height),i.bottom=d,this.size(e,new s.l(r,o),s.g.right+s.g.top);break;case"se-resize":i.right=Math.max(Math.min(r,i.left+a.width),i.left+h.width),i.bottom=Math.max(Math.min(l,i.top+a.height),i.top+h.height),this.size(e,new s.l(r,l),s.g.right+s.g.bottom);break;case"e-resize":i.right=Math.max(Math.min(r,i.left+a.width),i.left+h.width),this.size(e,new s.l(r,0),s.g.right);break;case"n-resize":i.top=Math.max(Math.min(o,i.bottom-h.height),i.bottom-a.height),i.bottom=d,this.size(e,new s.l(0,o),s.g.top);break;case"s-resize":i.bottom=Math.max(Math.min(l,i.top+a.height),i.top+h.height),this.size(e,new s.l(0,l),s.g.bottom);break;default:throw new Error("Invalid direction")}e.pixelBounds=i}else t.forEach(t=>{t.pixelBounds=new s.m(n+this.getPixelSize(this.dragRelativePosition[t.id].left),o+this.getPixelSize(this.dragRelativePosition[t.id].top),this.getPixelSize(t.percentBounds.width),this.getPixelSize(t.percentBounds.height))}),this.dragTarget=new s.m(this.getPercentSize(n),this.getPercentSize(o),this.targetBounds.width,this.targetBounds.height),this.move()}addTiles(t){if(!t||0===t.length)return;t.forEach(t=>{this.tiles.find(e=>e.id===t.id)||(this.tiles.find(e=>e.percentBounds&&t.percentBounds&&e.percentBounds.intersectWith(t.percentBounds))&&(t.percentBounds=void 0),t.percentBounds||(t.percentBounds=this.getFreePlace(t.idealBounds)),this.tiles.push(t),this.tilesDic[t.id]=t)});const e=new CustomEvent("DejaTilesAddEvent",{cancelable:!0});e.tiles=this.tiles,e.added=t,e.cancel$=new r.a;const i=this.clipboardService&&this.clipboardService.get("tiles-provider");let n;i&&(n=this.clipboardService.get("tiles")).forEach(t=>{t.isHidden=!0});const h=()=>{n&&(i.next(n),this.clipboardService.clear())},a=t=>{h();const e=new CustomEvent("DejaTileAddedEvent",{cancelable:!1});e.tiles=this.tiles,e.added=t,this.tilesAdded.next(e)},l=e.cancel$.pipe(Object(v.a)()).subscribe(e=>{e?(Object(o.a)(t).pipe(Object(u.a)(t=>t.isHidden=!0),Object(g.a)(1e3),Object(x.a)((t,e)=>[...t,e],[]),Object(v.a)()).subscribe(t=>this.deleteTiles(t)),n&&n.forEach(t=>{t.isHidden=!1,t.isCutted=!0})):a(t)});let c;t.forEach(t=>{c=c?s.m.union(c,t.percentBounds):new s.m(t.percentBounds)}),this.refreshTiles$.next({ensureBounds:c}),this.contentAdding.next(e),e.defaultPrevented||(l.unsubscribe(),a(t))}size(t,e,i){const r=new s.l(this.getPercentSize(e.left),this.getPercentSize(e.top)),n=t.percentBounds.clone(),o=t.percentBounds.clone();let h,a,l,c;if(i&s.g.left){h=this.getTileMinPercentWidth(),l=this.getTileMaxPercentWidth();const t=r.left,e=n.left<t?h*Math.ceil(t/h):h*Math.floor(t/h),i=Math.min(l,Math.max(h,o.right-e));n.width=n.right-t,n.left=t,o.left=o.right-i,o.width=i}if(i&s.g.right){h=h||this.getTileMinPercentWidth(),l=l||this.getTileMaxPercentWidth();const t=r.left,e=n.right<t?h*Math.ceil(t/h):h*Math.floor(t/h);n.width=t-n.left,o.width=Math.min(l,Math.max(h,e-o.left))}if(i&s.g.top){a=this.getTileMinPercentHeight(),c=this.getTileMaxPercentHeight();const t=r.top,e=n.top<t?a*Math.ceil(t/a):a*Math.floor(t/a),i=Math.min(c,Math.max(a,o.bottom-e));n.height=n.bottom-t,n.top=t,o.top=o.bottom-i,o.height=i}if(i&s.g.bottom){a=a||this.getTileMinPercentHeight(),c=c||this.getTileMaxPercentHeight();const t=r.top,e=n.bottom<t?a*Math.ceil(t/a):a*Math.floor(t/a);n.height=t-n.top,o.height=Math.min(c,Math.max(a,e-o.top))}if(!s.m.equals(o,this.destination))if(t.isExpanded){const e=this.ensureTarget(o,n,i);t.percentBounds=e,this.refreshTiles$.next()}else if(this.restoreLayout(this.originalLayout),this.destination=o.clone(),this.tiles.find(t=>!t.isDragging&&t.percentBounds.intersectWith(o))){if(o){const t=this.ensureTarget(o,n,i);t&&(this.targetBounds=t,this.validLayout=this.saveLayout(),this.validLayout.targetBounds=o,this.validLayout.validBounds=t,this.refreshTiles$.next())}}else this.targetBounds=o,this.validLayout=this.saveLayout(),this.validLayout.targetBounds=this.validLayout.validBounds=o,this.refreshTiles$.next()}move(){const t=this.getTileMinPercentWidth(),e=this.getTileMinPercentHeight(),i=this.ensureContainer(new s.m(t*Math.round(this.dragTarget.left/t),e*Math.round(this.dragTarget.top/e),this.dragTarget.width,this.dragTarget.height));this.lastTargetBounds&&Math.abs(i.left-this.lastTargetBounds.left)<t&&Math.abs(i.top-this.lastTargetBounds.top)<e||(this.lastTargetBounds=i,this.moveTimOut&&(this.moveTimOut.unsubscribe(),this.moveTimOut=void 0),this.restoreLayout(this.originalLayout),this.tiles.find(t=>!t.isDragging&&t.percentBounds.intersectWith(i))?this.moveTimOut=Object(l.a)(500).pipe(Object(v.a)()).subscribe(()=>{if(this.moveTimOut=void 0,this.destination=i.clone(),i){const t=this.ensureTarget(i,this.dragTarget,s.g.all);t&&(this.targetBounds=t,this.validLayout=this.saveLayout(),this.validLayout.targetBounds=i,this.validLayout.validBounds=t,this.refreshTiles$.next())}}):(this.targetBounds=i.clone(),this.destination=i.clone(),this.validLayout=this.saveLayout(),this.validLayout.targetBounds=this.validLayout.validBounds=i,this.refreshTiles$.next()))}ensureContainer(t){t.left<0&&(t=t.offset(-t.left,0)),t.top<0&&(t=t.offset(0,-t.top));const e=this.getMaxPercentWidth();e&&t.right>e&&(t=t.offset(e-t.right,0));const i=this.getMaxPercentHeight();return i&&t.bottom>i&&(t=t.offset(0,i-t.bottom)),t}ensureTarget(t,e,i,r){e||(e=t),r||(r=t.clone()),i?i|=s.g.bottom:i=s.g.all;const n=[],o=[],h=[],a=[];for(const c in this.tilesDic)if(this.tilesDic[c]){const r=this.tilesDic[c];if(!r.isDragging&&!r.isExpanded&&r.percentBounds.intersectWith(t)){const l=new s.m(this.dragOriginalPosition.left,this.dragOriginalPosition.top,t.width,t.height);if(r.percentBounds.left===e.left&&r.percentBounds.top===e.top&&r.percentBounds.width===e.width&&r.percentBounds.height===e.height&&e.adjacent(l))return r.percentBounds=l,t;{const t=r.percentBounds.left-e.left,l=e.right-r.percentBounds.right,c=r.percentBounds.top-e.top,d=e.bottom-r.percentBounds.bottom,u=Math.max(0,Math.min(r.percentBounds.right,e.right)-Math.max(r.percentBounds.left,e.left))/Math.min(r.percentBounds.width,e.width);let g;switch(g=Math.max(0,Math.min(r.percentBounds.bottom,e.bottom)-Math.max(r.percentBounds.top,e.top))/Math.min(r.percentBounds.height,e.height)>=u&&i&s.g.horizontal?l>=t&&i&s.g.left?s.g.left:s.g.right:d>=c&&i&s.g.top?s.g.top:s.g.bottom){case s.g.left:n.push(r);break;case s.g.top:h.push(r);break;case s.g.right:o.push(r);break;default:a.push(r)}}}}let l=0;return n.length&&(l=this.pushHorizontal(t,-1,n))?(t=this.ensureContainer(t.offset(l,0)),this.ensureTarget(t,e,i&~s.g.left,r)):(o.length&&(l=this.pushHorizontal(t,1,o)),l>0?(this.restoreLayout(this.originalLayout),this.ensureTarget(r,e,i&s.g.vertical)):h.length&&(l=this.pushVertical(t,-1,h))?(t=this.ensureContainer(t.offset(0,l)),this.ensureTarget(t,e,s.g.bottom)):(l=this.pushVertical(t,1,a))?null:t)}saveLayout(){const t={};return t.height=this.getTileMinPercentHeight(),this.tiles.forEach(e=>{const i=this.getPixelSize(e.percentBounds.top||0),s=this.getPixelSize(e.percentBounds.height||this._tileMinHeight);i+s>t.height&&(t.height=i+s),t[e.id]={bounds:e.percentBounds.clone(),id:e.id}}),t}getPixelBounds(t){return s.m.fromLTRB(Math.round(t.left*this.hundredPercentWith/100),Math.round(t.top*this.hundredPercentWith/100),Math.round(t.right*this.hundredPercentWith/100),Math.round(t.bottom*this.hundredPercentWith/100))}getPixelSize(t,e){return e&&"%"!==e?t:Math.round(t*this.hundredPercentWith/100)}getSizePercentLimit(t){const e=this[`${t}Unit`];return e&&"px"!==e?this[t]:this.getPercentSize(this[t])}getSizePixelLimit(t){const e=this[`${t}Unit`];return e&&"px"!==e?this.getPixelSize(this[t]):this[t]}getTileMinPixelSize(){return new s.n(this.getSizePixelLimit("_tileMinWidth"),this.getSizePixelLimit("_tileMinHeight"))}getTileMaxPixelSize(){return new s.n(this.getSizePixelLimit("_tileMaxWidth"),this.getSizePixelLimit("_tileMaxHeight"))}getTileMinPercentWidth(){return Math.max(1,this.getSizePercentLimit("_tileMinWidth"))}getTileMaxPercentWidth(){return Math.max(5,this.getSizePercentLimit("_tileMaxWidth"))}getTileMinPercentHeight(){return Math.max(1,this.getSizePercentLimit("_tileMinHeight"))}getTileMaxPercentHeight(){return Math.max(5,this.getSizePercentLimit("_tileMaxHeight"))}getMaxPercentWidth(){return Math.max(5,this.getSizePercentLimit("_maxWidth"))}getMaxPercentHeight(){return Math.max(5,this.getSizePercentLimit("_maxHeight"))}getCursorFromHTMLElement(t,e,i){const s=this.getTileElementFromHTMLElement(i);if(!s)return null;const r=s.getBoundingClientRect();return t<r.left+10?e<r.top+10?"nw-resize":e>r.bottom-10?"sw-resize":"w-resize":t>r.right-10?e<r.top+10?"ne-resize":e>r.bottom-10?"se-resize":"e-resize":e<r.top+10?"n-resize":e>r.bottom-10?"s-resize":"move"}extractValueAndUnit(t,e){const i=/(\d+)(.*)/i.exec(e);if(i&&i.length>=1){const e=this;e[t]=parseInt(i[1],10),e[`${t}Unit`]=i.length>=2?i[2]:"px"}}restoreLayout(t){this.tiles.forEach(e=>{e.percentBounds=t[e.id].bounds.clone()})}calcHorizontalOverflow(t,e,i,s){let r=0;return s=s||{},e.forEach(e=>{if(!s[e.id]){s[e.id]=e.id;const n=e.percentBounds.offset(t*i,0);let o=0;const h=this.getMaxPercentWidth();n.left<0?o=-n.left:h&&n.right>h&&(o=n.right-h);const a=this.tiles.filter(t=>!t.isDragging&&!t.equalsTo(e)&&t.percentBounds.intersectWith(n));a.length&&(o+=this.calcHorizontalOverflow(t,a,i,s)),o>r&&(r=o)}}),r}moveHorizontal(t,e,i,s){e.forEach(e=>{if(!s[e.id]){const r=s[e.id]=e.percentBounds.offset(t*i,0),n=this.tiles.filter(t=>!t.isDragging&&!t.equalsTo(e)&&t.percentBounds.intersectWith(r));n.length&&this.moveHorizontal(t,n,i,s)}})}pushHorizontal(t,e,i,s){let r=0;const n={};return s||(s=0,i.forEach(i=>{const r=e>0?Math.max(0,t.right-i.percentBounds.left):Math.max(0,i.percentBounds.right-t.left);r>s&&(s=r)})),s>0&&(r=this.calcHorizontalOverflow(e,i,s),(s-=r)>0&&(this.moveHorizontal(e,i,s,n),this.tiles.forEach(t=>{n[t.id]&&(t.percentBounds=n[t.id])}))),r}calcVerticalOverflow(t,e,i,s){let r=0;return s=s||{},e.forEach(e=>{if(!s[e.id]){s[e.id]=e.id;const n=e.percentBounds.offset(0,t*i);let o=0;const h=this.getMaxPercentHeight();n.top<0?o=-n.top:h&&n.bottom>h&&(o=n.bottom-h);const a=this.tiles.filter(t=>!t.isDragging&&!t.equalsTo(e)&&t.percentBounds.intersectWith(n));a.length&&(o+=this.calcVerticalOverflow(t,a,i,s)),o>r&&(r=o)}}),r}moveVertical(t,e,i,s){e.forEach(e=>{if(!s[e.id]){const r=s[e.id]=e.percentBounds.offset(0,t*i),n=this.tiles.filter(t=>!t.isDragging&&!t.equalsTo(e)&&t.percentBounds.intersectWith(r));n.length&&this.moveVertical(t,n,i,s)}})}pushVertical(t,e,i,s){let r=0;const n={};return s||(s=0,i.forEach(i=>{const r=e>0?Math.max(0,t.bottom-i.percentBounds.top):Math.max(0,i.percentBounds.bottom-t.top);r>s&&(s=r)})),s>0&&(r=this.calcVerticalOverflow(e,i,s),(s-=r)>0&&(this.moveVertical(e,i,s,n),this.tiles.forEach(t=>{n[t.id]&&(t.percentBounds=n[t.id])}))),r}copyTiles(t,e){if(!this.clipboardService){if(!t)return;throw new Error("DejaClipboardService must be imported by your application to use the copyTiles methode of DejaTilesComponent.")}const i=this.clipboardService.get("tiles");i&&i.forEach(t=>t.isCutted=!1),this.clipboardService.set("tiles",t),e?(t.forEach(t=>t.isCutted=!0),this.clipboardService.set("tiles-provider",this.deleteTiles$)):this.clipboardService.set("tiles-provider",void 0)}removeTemporaryTile(){let t=this.tiles.length;for(;--t>=0;){const e=this.tiles[t];e.isTemporary&&(delete this.tilesDic[e.id],this.tiles.splice(t,1))}}}},UMfw:function(t,e,i){"use strict";i.d(e,"a",function(){return h});var s=i("fYS1"),r=i("2Vo4"),n=i("jtHE"),o=i("XNiG");const h=(()=>{class t{constructor(e){this.cutted$=new r.a(!1),this.dragging$=new r.a(!1),this.dropping$=new r.a(!1),this.pressed$=new r.a(!1),this.selected$=new r.a(!1),this.expanded$=new r.a(!1),this.hidden$=new n.a(1),this.pixelBounds$=new r.a(null),this.deleted$=new o.a,this.refresh$=new o.a,this.isTemporary=!1,this._isDragging=!1,this._isDropping=!1,this._isPressed=!1,this._isExpanded=!1,this._isHidden=!1,this._id=e||`#${t.currentId++}`}get idealBounds(){return new s.m(0,0,15,15)}set pixelBounds(t){s.m.equals(this._pixelBounds,t)||(this._pixelBounds=t,this.pixelBounds$.next(t))}get pixelBounds(){return this._pixelBounds}set percentBounds(t){this._percentBounds=t}get percentBounds(){return this._percentBounds}set templateModel(t){this._templateModel=t}get templateModel(){return this._templateModel}get id(){return this._id}set isCutted(t){this._cutted!==t&&(this._cutted=t,this.cutted$.next(t))}get isCutted(){return this._cutted}set color(t){this._color=t}get color(){return this._color}set isDragging(t){this._isDragging!==t&&(this._isDragging=t,this.dragging$.next(t))}get isDragging(){return this._isDragging}set isDropping(t){this._isDropping!==t&&(this._isDropping=t,this.dropping$.next(t))}get isDropping(){return this._isDropping}set isPressed(t){this._isPressed!==t&&(this._isPressed=t,this.pressed$.next(t))}get isPressed(){return this._isPressed}set isSelected(t){this._selected!==t&&(this._selected=t,this.selected$.next(t))}get isSelected(){return this._selected}set isExpanded(t){this._isExpanded!==t&&(this._isExpanded=t,this.expanded$.next(t))}get isExpanded(){return this._isExpanded}set isHidden(t){this._isHidden!==t&&(this._isHidden=t,this.hidden$.next(t))}get isHidden(){return this._isHidden}set isPending(t){this._pending=t}get fading(){return this._fading}set fading(t){this._fading=t}get isPending(){return this._pending}makeId(){this._id=`#${t.currentId++}`}equalsTo(t){return this._templateModel?this._templateModel===t._templateModel:this._id===t._id}clone(e){return e||(e=new t(this.id)),e._percentBounds=this.percentBounds,e._color=this.color,e._templateModel=this.templateModel,e._cutted=this._cutted,e._selected=this._selected,e._pending=this._pending,e._fading=this._fading,e}delete(){this.deleted$.next()}refresh(){this.refresh$.next()}}return t.currentId=0,t})()},Z3dl:function(t,e,i){"use strict";i.d(e,"a",function(){return s}),i("+qQs");class s{}},dSv2:function(t,e,i){"use strict";i.d(e,"a",function(){return s}),i("fYS1");class s{constructor(t){this.element=t.nativeElement,this.element.style.display="none"}set bounds(t){if(t){const{left:e,top:i,width:s,height:r}=t;this.element.style.left=`${e}px`,this.element.style.top=`${i}px`,this.element.style.width=`${s}px`,this.element.style.height=`${r}px`,this.element.style.display="block"}else this.element.style.display="none"}}},ja5E:function(t,e,i){"use strict";i.d(e,"a",function(){return n});var s=i("MPFR"),r=i("qLWr");class n extends s.d{constructor(){super(),this.toolbarType="window",this.title="Modifier l'apparence du groupe",this.actions=[new s.b("confirm","Ok","done"),new s.b("cancel","Cancel","cancel")],this.fullscreen=!1,this.hasBackdrop=!0,this.disableClose=!0,this.contentComponentRef=r.a}}},"nN/P":function(t,e,i){"use strict";i.d(e,"a",function(){return r});var s=i("qF2d");i("vg1q"),i("1WO2"),i("KVC5");class r{static forRoot(){return{ngModule:r,providers:[s.a]}}}},qF2d:function(t,e,i){"use strict";i.d(e,"a",function(){return h});var s=i("2Vo4"),r=i("XNiG"),n=i("vkgz"),o=i("pLZG");class h{constructor(){this._context={},this._isDragging=!1,this.dragCursor$=new s.a(void 0),this.dropCursor$=new r.a,this.dragging$=new s.a(!1),this.dragging$.pipe(Object(n.a)(t=>this._isDragging=t),Object(o.a)(t=>!t)).subscribe(()=>this._context={})}get isDragging(){return this._isDragging}set context(t){this._context=t}get context(){return this._context}}},qLWr:function(t,e,i){"use strict";i.d(e,"a",function(){return o});var s=i("MPFR"),r=i("fYS1"),n=i("Fp2t");class o extends s.c{constructor(){super(...arguments),this.min=0,this.max=20,this.widthStep=2}ngOnInit(){this.materialColors=this.injector.get(r.k),this.model=this.config.data}get borderColor(){return this.model&&this.model.borderColor?r.b.fromHex(this.model.borderColor):null}set borderColor(t){this.model.borderColor=t.toHex(),this.model.update(this.model.borderWidth,this.model.borderColor,this.model.borderDirection)}get borderWidth(){return this.model&&this.model.borderWidth/2||null}set borderWidth(t){t>=this.min&&t<=this.max&&(this.model.borderWidth=t*this.widthStep,this.model.update(this.model.borderWidth,this.model.borderColor,this.model.borderDirection))}get topBorder(){return!!this.model&&0!=(this.model.borderDirection&n.a.top)}set topBorder(t){this.model&&(t?this.model.borderDirection|=n.a.top:this.model.borderDirection&=~n.a.top,this.model.update(this.model.borderWidth,this.model.borderColor,this.model.borderDirection))}get rightBorder(){return!!this.model&&0!=(this.model.borderDirection&n.a.right)}set rightBorder(t){this.model&&(t?this.model.borderDirection|=n.a.right:this.model.borderDirection&=~n.a.right,this.model.update(this.model.borderWidth,this.model.borderColor,this.model.borderDirection))}get bottomBorder(){return!!this.model&&0!=(this.model.borderDirection&n.a.bottom)}set bottomBorder(t){this.model&&(t?this.model.borderDirection|=n.a.bottom:this.model.borderDirection&=~n.a.bottom,this.model.update(this.model.borderWidth,this.model.borderColor,this.model.borderDirection))}get leftBorder(){return!!this.model&&0!=(this.model.borderDirection&n.a.left)}set leftBorder(t){this.model&&(t?this.model.borderDirection|=n.a.left:this.model.borderDirection&=~n.a.left,this.model.update(this.model.borderWidth,this.model.borderColor,this.model.borderDirection))}}},sOkG:function(t,e,i){"use strict";i.d(e,"a",function(){return u});var s=i("KCVW"),r=i("8Y7J"),n=i("fYS1"),o=i("Cfvw"),h=i("xgIS"),a=i("GJmQ"),l=i("Kj3r"),c=i("pLZG");i("SsaN");const d=()=>{};class u{constructor(t,e,i,s){this.changeDetectorRef=e,this.layoutProvider=i,this._control=s,this.selectionChanged=new r.EventEmitter,this.layoutChanged=new r.EventEmitter,this.layoutCompleted=new r.EventEmitter,this.contentAdding=new r.EventEmitter,this.contentRemoving=new r.EventEmitter,this.tileGroupChanged=new r.EventEmitter,this.tilesAdded=new r.EventEmitter,this.tilesDeleted=new r.EventEmitter,this.contentCopied=new r.EventEmitter,this.tabIndex=0,this.onTouchedCallback=d,this.onChangeCallback=d,this._models=[],this.isAlive=!0,this.hasFocus=!1,this._control&&(this._control.valueAccessor=this);const n=t.nativeElement;Object(o.a)(this.layoutProvider.selectionChanged).pipe(Object(a.a)(()=>this.isAlive)).subscribe(t=>this.selectionChanged.emit(t)),Object(o.a)(this.layoutProvider.contentAdding).pipe(Object(a.a)(()=>this.isAlive)).subscribe(t=>this.contentAdding.emit(t)),Object(o.a)(this.layoutProvider.contentRemoving).pipe(Object(a.a)(()=>this.isAlive)).subscribe(t=>this.contentRemoving.emit(t)),Object(o.a)(this.layoutProvider.tilesAdded).pipe(Object(a.a)(()=>this.isAlive)).subscribe(t=>{this.tilesAdded.emit(t),this.onChangeCallback(t.tiles)}),Object(o.a)(this.layoutProvider.tilesDeleted).pipe(Object(a.a)(()=>this.isAlive)).subscribe(t=>{this.tilesDeleted.emit(t),this.onChangeCallback(t.tiles)}),Object(o.a)(this.layoutProvider.layoutChanged).pipe(Object(a.a)(()=>this.isAlive)).subscribe(t=>{this.layoutChanged.emit(t),this.onChangeCallback(t.tiles)}),Object(o.a)(this.layoutProvider.layoutCompleted).pipe(Object(a.a)(()=>this.isAlive)).subscribe(t=>this.layoutCompleted.emit(t)),this.keyup$=Object(h.a)(n.ownerDocument,"keyup"),Object(h.a)(window,"resize").pipe(Object(a.a)(()=>this.isAlive),Object(l.a)(5)).subscribe(()=>this.refresh({resetWidth:!0}))}get tiles(){return this.layoutProvider.tiles}get selectionRect$(){return this.layoutProvider.selectionRect$}set tileminwidth(t){this.layoutProvider.tileMinWidth=t}set tilemaxwidth(t){this.layoutProvider.tileMaxWidth=t}set tileminheight(t){this.layoutProvider.tileMinHeight=t}set tilemaxheight(t){this.layoutProvider.tileMaxHeight=t}set maxwidth(t){this.layoutProvider.maxWidth=t}set designMode(t){this.layoutProvider.designMode=Object(s.b)(t)}get designMode(){return this.layoutProvider.designMode}set models(t){this.writeValue(t)}set canDelete(t){Object(s.b)(t)&&!this.delete$sub?this.delete$sub=this.keyup$.pipe(Object(c.a)(()=>this.layoutProvider.designMode),Object(c.a)(t=>(t.keyCode||n.j[t.code])===n.j.Delete&&this.hasFocus)).subscribe(()=>this.layoutProvider.deleteSelection()):this.delete$sub&&(this.delete$sub.unsubscribe(),this.delete$sub=void 0)}set canCopy(t){Object(s.b)(t)&&!this.copy$sub?this.copy$sub=this.keyup$.pipe(Object(c.a)(t=>(t.keyCode||n.j[t.code])===n.j.KeyC&&t.ctrlKey&&this.hasFocus)).subscribe(()=>{this.copySelection()}):this.copy$sub&&(this.copy$sub.unsubscribe(),this.copy$sub=void 0)}set canCut(t){Object(s.b)(t)&&!this.cut$sub?this.cut$sub=this.keyup$.pipe(Object(c.a)(()=>this.layoutProvider.designMode),Object(c.a)(t=>(t.keyCode||n.j[t.code])===n.j.KeyX&&t.ctrlKey&&this.hasFocus)).subscribe(()=>{this.cutSelection()}):this.cut$sub&&(this.cut$sub.unsubscribe(),this.cut$sub=void 0)}set canPaste(t){Object(s.b)(t)&&!this.paste$sub?this.paste$sub=this.keyup$.pipe(Object(c.a)(()=>this.layoutProvider.designMode),Object(c.a)(t=>(t.keyCode||n.j[t.code])===n.j.KeyV&&t.ctrlKey&&this.hasFocus)).subscribe(()=>this.paste()):this.paste$sub&&(this.paste$sub.unsubscribe(),this.paste$sub=void 0)}set selectedTiles(t){this.layoutProvider.selectedTiles=t.map(t=>"string"==typeof t?t:t.id)}writeValue(t){this._models=t||[],this.layoutProvider.tiles=this._models,this.changeDetectorRef.markForCheck()}registerOnChange(t){this.onChangeCallback=t}registerOnTouched(t){this.onTouchedCallback=t}ngAfterViewInit(){this.layoutProvider.container=this.tilesContainer.nativeElement,this.refresh({resetWidth:!0})}ngOnDestroy(){this.layoutProvider.ngOnDestroy(),this.canCopy=!1,this.canCut=!1,this.canDelete=!1,this.canPaste=!1,this.isAlive=!1}copySelection(){const t=this.layoutProvider.copySelection();if(t&&t.length){const e=new CustomEvent("DejaTilesCopied",{cancelable:!0});e.tiles=t,this.contentCopied.emit(e)}}cutSelection(){const t=this.layoutProvider.cutSelection();if(t&&t.length){const e=new CustomEvent("DejaTilesCutted",{cancelable:!0});e.tiles=t,this.contentCopied.emit(e)}}deleteSelection(){const t=this.layoutProvider.deleteSelection();return this.changeDetectorRef.markForCheck(),t}paste(){const t=this.layoutProvider.paste();return this.changeDetectorRef.markForCheck(),t}ensureVisible(t){this.layoutProvider.ensureVisible$.next(t)}expandTile(t,e){this.layoutProvider.expandTile(t,e)}cancelExpand(){this.layoutProvider.cancelExpand()}refresh(t){this.layoutProvider.refreshTiles$.next(t)}addTiles(t){this.layoutProvider.addTiles(t)}removeTiles(t){this.layoutProvider.removeTiles(t)}getFreePlace(t,e,i,s){if(!this._models||0===this._models.length)return new n.m(0,0,i,s);const r=this.tilesContainer.nativeElement.getBoundingClientRect(),o=e?e-r.top:0,h=new n.m(this.layoutProvider.getPercentSize(t?t-r.left:0),this.layoutProvider.getPercentSize(o),i,s);return this.layoutProvider.getFreePlace(h)}moveTile(t,e){this.layoutProvider.moveTile(t,e)}getDropContext(){return{dragEnter:(t,e)=>this.layoutProvider.dragEnter(t,e)&&{className:"hidden"},dragOver:(t,e)=>{this.layoutProvider.dragover$.next(e)},dragLeave:t=>{this.layoutProvider.dragleave$.next()}}}onTileClosed(t){this.layoutProvider.removeTiles([t.id])}onTileGroupModelChanged(t){const e=new CustomEvent("DejaTileGroupModelEvent",{cancelable:!1});e.tileGroup=t,this.tileGroupChanged.emit(e)}onFocus(){this.hasFocus=!0}onBlur(){this.hasFocus=!1}}},tMTD:function(t,e,i){"use strict";i.d(e,"c",function(){return n}),i("ja5E"),i("qLWr");var s=i("Fp2t");i.d(e,"b",function(){return s.b}),i("DMiE");var r=i("UMfw");i.d(e,"a",function(){return r.a}),i("JyZx"),i("dSv2"),i("SsaN"),i("sOkG");class n{}},vg1q:function(t,e,i){"use strict";i.d(e,"a",function(){return u});var s=i("fYS1"),r=i("xgIS"),n=i("XNiG"),o=i("VRyK"),h=i("GJmQ"),a=i("1G5W"),l=i("pLZG"),c=i("SxV6"),d=i("vkgz");i("qF2d");class u{constructor(t,e){this.isAlive=!0;const i=t.nativeElement,u=Object(r.a)(i,"mouseleave"),g=Object(r.a)(i.ownerDocument,"mouseup");Object(r.a)(i,"mouseenter").pipe(Object(h.a)(()=>this.isAlive)).subscribe(()=>{Object(r.a)(i,"mousedown").pipe(Object(a.a)(u),Object(l.a)(t=>1===t.buttons)).subscribe(t=>{const h=new n.a;let l;const u=t=>t.tagName===this.context.target.toUpperCase()||t.id===this.context.target.substr(1)||t.hasAttribute(this.context.target.substring(1,this.context.target.length-1)),p=()=>{const t=Object(o.a)(g,h).pipe(Object(c.a)(),Object(d.a)(()=>{e.dragCursor$.next(void 0),e.dragging$.next(!1)}));Object(r.a)(i.ownerDocument,"mousemove").pipe(Object(a.a)(t)).subscribe(t=>{if(l&&1===t.buttons){const r=new s.m(i.getBoundingClientRect()),n=new s.l(t.pageX,t.pageY),o=r.containsPoint(n)?l.innerHTML:void 0;e.dragCursor$.next({position:n,html:o,width:l.offsetWidth,height:l.offsetHeight,className:this.context.className,originalEvent:t})}else h.next();return t.preventDefault(),!1}),e.dragging$.next(!0)};if(this.context){if(this.context.target)for(l=t.target;l&&!u(l);)l=l.parentElement;else l=i;if(l&&this.context.dragStart){const t=this.context.dragStart(l);if(t){if(t.subscribe)return void t.pipe(Object(c.a)()).subscribe(t=>{e.context=t,t&&p()});e.context=t,p()}}}})})}set context(t){this._context=t}get context(){return this._context}ngOnDestroy(){this.isAlive=!1}}}}]);