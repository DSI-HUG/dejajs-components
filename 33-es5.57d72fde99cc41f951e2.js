function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _get(e,t,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=_superPropBase(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,i=_getPrototypeOf(e);if(t){var r=_getPrototypeOf(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{"ToA/":function(e,t,n){"use strict";n.r(t);var i=n("SVse"),r=n("s7LF"),o=n("Dxy4"),s=n("PDjf"),a=n("pMoy"),c=n("M9ds"),l=n("l0rg"),d=n("650w"),u=n("PO1J"),h=n("KUKF"),f=n("mrSG"),p=n("8Y7J"),g=n("UhP/"),m=n("8LU1"),v=n("omvX"),b=n("SCoL");function y(e,t){if(1&e&&(p["\u0275\u0275namespaceSVG"](),p["\u0275\u0275element"](0,"circle",3)),2&e){var n=p["\u0275\u0275nextContext"]();p["\u0275\u0275styleProp"]("animation-name","mat-progress-spinner-stroke-rotate-"+n.diameter)("stroke-dashoffset",n._strokeDashOffset,"px")("stroke-dasharray",n._strokeCircumference,"px")("stroke-width",n._circleStrokeWidth,"%"),p["\u0275\u0275attribute"]("r",n._circleRadius)}}function x(e,t){if(1&e&&(p["\u0275\u0275namespaceSVG"](),p["\u0275\u0275element"](0,"circle",3)),2&e){var n=p["\u0275\u0275nextContext"]();p["\u0275\u0275styleProp"]("stroke-dashoffset",n._strokeDashOffset,"px")("stroke-dasharray",n._strokeCircumference,"px")("stroke-width",n._circleStrokeWidth,"%"),p["\u0275\u0275attribute"]("r",n._circleRadius)}}var k,w,_=Object(g.u)((function e(t){_classCallCheck(this,e),this._elementRef=t}),"primary"),j=new p.InjectionToken("mat-progress-spinner-default-options",{providedIn:"root",factory:function(){return{diameter:100}}}),M=((w=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,i,r,o,s){var a;_classCallCheck(this,n),(a=t.call(this,e))._elementRef=e,a._document=r,a._diameter=100,a._value=0,a._fallbackAnimation=!1,a.mode="determinate";var c=n._diameters;return c.has(r.head)||c.set(r.head,new Set([100])),a._fallbackAnimation=i.EDGE||i.TRIDENT,a._noopAnimations="NoopAnimations"===o&&!!s&&!s._forceAnimations,s&&(s.diameter&&(a.diameter=s.diameter),s.strokeWidth&&(a.strokeWidth=s.strokeWidth)),a}return _createClass(n,[{key:"ngOnInit",value:function(){var e=this._elementRef.nativeElement;this._styleRoot=function(e,t){if("undefined"!=typeof window){var n=t.head;if(n&&(n.createShadowRoot||n.attachShadow)){var i=e.getRootNode?e.getRootNode():null;if(i instanceof window.ShadowRoot)return i}}return null}(e,this._document)||this._document.head,this._attachStyleNode(),e.classList.add("mat-progress-spinner-indeterminate".concat(this._fallbackAnimation?"-fallback":"","-animation"))}},{key:"_attachStyleNode",value:function(){var e=this._styleRoot,t=this._diameter,i=n._diameters,r=i.get(e);if(!r||!r.has(t)){var o=this._document.createElement("style");o.setAttribute("mat-spinner-animation",t+""),o.textContent=this._getAnimationText(),e.appendChild(o),r||(r=new Set,i.set(e,r)),r.add(t)}}},{key:"_getAnimationText",value:function(){return"\n @keyframes mat-progress-spinner-stroke-rotate-DIAMETER {\n    0%      { stroke-dashoffset: START_VALUE;  transform: rotate(0); }\n    12.5%   { stroke-dashoffset: END_VALUE;    transform: rotate(0); }\n    12.5001%  { stroke-dashoffset: END_VALUE;    transform: rotateX(180deg) rotate(72.5deg); }\n    25%     { stroke-dashoffset: START_VALUE;  transform: rotateX(180deg) rotate(72.5deg); }\n\n    25.0001%   { stroke-dashoffset: START_VALUE;  transform: rotate(270deg); }\n    37.5%   { stroke-dashoffset: END_VALUE;    transform: rotate(270deg); }\n    37.5001%  { stroke-dashoffset: END_VALUE;    transform: rotateX(180deg) rotate(161.5deg); }\n    50%     { stroke-dashoffset: START_VALUE;  transform: rotateX(180deg) rotate(161.5deg); }\n\n    50.0001%  { stroke-dashoffset: START_VALUE;  transform: rotate(180deg); }\n    62.5%   { stroke-dashoffset: END_VALUE;    transform: rotate(180deg); }\n    62.5001%  { stroke-dashoffset: END_VALUE;    transform: rotateX(180deg) rotate(251.5deg); }\n    75%     { stroke-dashoffset: START_VALUE;  transform: rotateX(180deg) rotate(251.5deg); }\n\n    75.0001%  { stroke-dashoffset: START_VALUE;  transform: rotate(90deg); }\n    87.5%   { stroke-dashoffset: END_VALUE;    transform: rotate(90deg); }\n    87.5001%  { stroke-dashoffset: END_VALUE;    transform: rotateX(180deg) rotate(341.5deg); }\n    100%    { stroke-dashoffset: START_VALUE;  transform: rotateX(180deg) rotate(341.5deg); }\n  }\n".replace(/START_VALUE/g,""+.95*this._strokeCircumference).replace(/END_VALUE/g,""+.2*this._strokeCircumference).replace(/DIAMETER/g,""+this.diameter)}},{key:"diameter",get:function(){return this._diameter},set:function(e){this._diameter=Object(m.e)(e),!this._fallbackAnimation&&this._styleRoot&&this._attachStyleNode()}},{key:"strokeWidth",get:function(){return this._strokeWidth||this.diameter/10},set:function(e){this._strokeWidth=Object(m.e)(e)}},{key:"value",get:function(){return"determinate"===this.mode?this._value:0},set:function(e){this._value=Math.max(0,Math.min(100,Object(m.e)(e)))}},{key:"_circleRadius",get:function(){return(this.diameter-10)/2}},{key:"_viewBox",get:function(){var e=2*this._circleRadius+this.strokeWidth;return"0 0 ".concat(e," ").concat(e)}},{key:"_strokeCircumference",get:function(){return 2*Math.PI*this._circleRadius}},{key:"_strokeDashOffset",get:function(){return"determinate"===this.mode?this._strokeCircumference*(100-this._value)/100:this._fallbackAnimation&&"indeterminate"===this.mode?.2*this._strokeCircumference:null}},{key:"_circleStrokeWidth",get:function(){return this.strokeWidth/this.diameter*100}}]),n}(_)).\u0275fac=function(e){return new(e||w)(p["\u0275\u0275directiveInject"](p.ElementRef),p["\u0275\u0275directiveInject"](b.a),p["\u0275\u0275directiveInject"](i.d,8),p["\u0275\u0275directiveInject"](v.a,8),p["\u0275\u0275directiveInject"](j))},w.\u0275cmp=p["\u0275\u0275defineComponent"]({type:w,selectors:[["mat-progress-spinner"]],hostAttrs:["role","progressbar",1,"mat-progress-spinner"],hostVars:10,hostBindings:function(e,t){2&e&&(p["\u0275\u0275attribute"]("aria-valuemin","determinate"===t.mode?0:null)("aria-valuemax","determinate"===t.mode?100:null)("aria-valuenow","determinate"===t.mode?t.value:null)("mode",t.mode),p["\u0275\u0275styleProp"]("width",t.diameter,"px")("height",t.diameter,"px"),p["\u0275\u0275classProp"]("_mat-animation-noopable",t._noopAnimations))},inputs:{color:"color",mode:"mode",diameter:"diameter",strokeWidth:"strokeWidth",value:"value"},exportAs:["matProgressSpinner"],features:[p["\u0275\u0275InheritDefinitionFeature"]],decls:3,vars:8,consts:[["preserveAspectRatio","xMidYMid meet","focusable","false",3,"ngSwitch"],["cx","50%","cy","50%",3,"animation-name","stroke-dashoffset","stroke-dasharray","stroke-width",4,"ngSwitchCase"],["cx","50%","cy","50%",3,"stroke-dashoffset","stroke-dasharray","stroke-width",4,"ngSwitchCase"],["cx","50%","cy","50%"]],template:function(e,t){1&e&&(p["\u0275\u0275namespaceSVG"](),p["\u0275\u0275elementStart"](0,"svg",0),p["\u0275\u0275template"](1,y,1,9,"circle",1),p["\u0275\u0275template"](2,x,1,7,"circle",2),p["\u0275\u0275elementEnd"]()),2&e&&(p["\u0275\u0275styleProp"]("width",t.diameter,"px")("height",t.diameter,"px"),p["\u0275\u0275property"]("ngSwitch","indeterminate"===t.mode),p["\u0275\u0275attribute"]("viewBox",t._viewBox),p["\u0275\u0275advance"](1),p["\u0275\u0275property"]("ngSwitchCase",!0),p["\u0275\u0275advance"](1),p["\u0275\u0275property"]("ngSwitchCase",!1))},directives:[i.p,i.q],styles:[".mat-progress-spinner{display:block;position:relative}.mat-progress-spinner svg{position:absolute;transform:rotate(-90deg);top:0;left:0;transform-origin:center;overflow:visible}.mat-progress-spinner circle{fill:transparent;transform-origin:center;transition:stroke-dashoffset 225ms linear}._mat-animation-noopable.mat-progress-spinner circle{transition:none;animation:none}.mat-progress-spinner.mat-progress-spinner-indeterminate-animation[mode=indeterminate]{animation:mat-progress-spinner-linear-rotate 2000ms linear infinite}._mat-animation-noopable.mat-progress-spinner.mat-progress-spinner-indeterminate-animation[mode=indeterminate]{transition:none;animation:none}.mat-progress-spinner.mat-progress-spinner-indeterminate-animation[mode=indeterminate] circle{transition-property:stroke;animation-duration:4000ms;animation-timing-function:cubic-bezier(0.35, 0, 0.25, 1);animation-iteration-count:infinite}._mat-animation-noopable.mat-progress-spinner.mat-progress-spinner-indeterminate-animation[mode=indeterminate] circle{transition:none;animation:none}.mat-progress-spinner.mat-progress-spinner-indeterminate-fallback-animation[mode=indeterminate]{animation:mat-progress-spinner-stroke-rotate-fallback 10000ms cubic-bezier(0.87, 0.03, 0.33, 1) infinite}._mat-animation-noopable.mat-progress-spinner.mat-progress-spinner-indeterminate-fallback-animation[mode=indeterminate]{transition:none;animation:none}.mat-progress-spinner.mat-progress-spinner-indeterminate-fallback-animation[mode=indeterminate] circle{transition-property:stroke}._mat-animation-noopable.mat-progress-spinner.mat-progress-spinner-indeterminate-fallback-animation[mode=indeterminate] circle{transition:none;animation:none}@keyframes mat-progress-spinner-linear-rotate{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes mat-progress-spinner-stroke-rotate-100{0%{stroke-dashoffset:268.606171575px;transform:rotate(0)}12.5%{stroke-dashoffset:56.5486677px;transform:rotate(0)}12.5001%{stroke-dashoffset:56.5486677px;transform:rotateX(180deg) rotate(72.5deg)}25%{stroke-dashoffset:268.606171575px;transform:rotateX(180deg) rotate(72.5deg)}25.0001%{stroke-dashoffset:268.606171575px;transform:rotate(270deg)}37.5%{stroke-dashoffset:56.5486677px;transform:rotate(270deg)}37.5001%{stroke-dashoffset:56.5486677px;transform:rotateX(180deg) rotate(161.5deg)}50%{stroke-dashoffset:268.606171575px;transform:rotateX(180deg) rotate(161.5deg)}50.0001%{stroke-dashoffset:268.606171575px;transform:rotate(180deg)}62.5%{stroke-dashoffset:56.5486677px;transform:rotate(180deg)}62.5001%{stroke-dashoffset:56.5486677px;transform:rotateX(180deg) rotate(251.5deg)}75%{stroke-dashoffset:268.606171575px;transform:rotateX(180deg) rotate(251.5deg)}75.0001%{stroke-dashoffset:268.606171575px;transform:rotate(90deg)}87.5%{stroke-dashoffset:56.5486677px;transform:rotate(90deg)}87.5001%{stroke-dashoffset:56.5486677px;transform:rotateX(180deg) rotate(341.5deg)}100%{stroke-dashoffset:268.606171575px;transform:rotateX(180deg) rotate(341.5deg)}}@keyframes mat-progress-spinner-stroke-rotate-fallback{0%{transform:rotate(0deg)}25%{transform:rotate(1170deg)}50%{transform:rotate(2340deg)}75%{transform:rotate(3510deg)}100%{transform:rotate(4680deg)}}\n"],encapsulation:2,changeDetection:0}),w._diameters=new WeakMap,w),O=((k=function e(){_classCallCheck(this,e)}).\u0275mod=p["\u0275\u0275defineNgModule"]({type:k}),k.\u0275inj=p["\u0275\u0275defineInjector"]({factory:function(e){return new(e||k)},imports:[[g.h,i.c],g.h]}),k),C=n("Z5sx"),P=n("2Vo4"),T=n("jtHE"),E=n("XNiG"),B=n("Cfvw"),S=n("VRyK"),D=n("xgIS"),$=n("LRne"),A=n("PqYM"),R=n("pLZG"),z=n("SxV6"),L=n("vkgz"),F=n("3E0/"),I=n("Kj3r"),W=n("1G5W"),H=n("lJxs"),V=n("eIep"),U=n("IzEk"),X=n("128B");function N(e,t){}function q(e,t){if(1&e&&p["\u0275\u0275element"](0,"mat-progress-spinner",2),2&e){var n=p["\u0275\u0275nextContext"]();p["\u0275\u0275property"]("diameter",n.progressDiameter)}}var Y=function(e,t){return{$implicit:e,designMode:t}},K=["tileTemplate"],G=["tilesContainer"];function J(e,t){if(1&e){var n=p["\u0275\u0275getCurrentView"]();p["\u0275\u0275elementStart"](0,"deja-tile",4),p["\u0275\u0275listener"]("close",(function(){p["\u0275\u0275restoreView"](n);var e=t.$implicit;return p["\u0275\u0275nextContext"]().onTileClosed(e)})),p["\u0275\u0275elementEnd"]()}if(2&e){var i=t.$implicit,r=t.index,o=p["\u0275\u0275nextContext"]();p["\u0275\u0275property"]("id",i.id)("tile",i)("designMode",o.designMode)("template",o.tileTemplate),p["\u0275\u0275attribute"]("tile-index",r)}}var Q,Z,ee,te,ne,ie,re=((ie=function(){function e(t){_classCallCheck(this,e),this.element=t.nativeElement,this.element.style.display="none"}return _createClass(e,[{key:"bounds",set:function(e){if(e){var t=e.left,n=e.top,i=e.width,r=e.height;this.element.style.left=t+"px",this.element.style.top=n+"px",this.element.style.width=i+"px",this.element.style.height=r+"px",this.element.style.display="block"}else this.element.style.display="none"}}]),e}()).\u0275fac=function(e){return new(e||ie)(p["\u0275\u0275directiveInject"](p.ElementRef))},ie.\u0275dir=p["\u0275\u0275defineDirective"]({type:ie,selectors:[["","deja-tile-position",""]],inputs:{bounds:"bounds"}}),ie),oe=((ne=function(){function e(t){_classCallCheck(this,e),this.cutted$=new P.a(!1),this.dragging$=new P.a(!1),this.dropping$=new P.a(!1),this.pressed$=new P.a(!1),this.selected$=new P.a(!1),this.hidden$=new T.a(1),this.pixelBounds$=new P.a(null),this.deleted$=new E.a,this.refresh$=new E.a,this.isTemporary=!1,this._isDragging=!1,this._isDropping=!1,this._isPressed=!1,this._isHidden=!1,this._id=t||"#"+e.currentId++}return _createClass(e,[{key:"makeId",value:function(){this._id="#"+e.currentId++}},{key:"equalsTo",value:function(e){return this._templateModel?this._templateModel===e._templateModel:this._id===e._id}},{key:"clone",value:function(t){return t||(t=new e(this.id)),t._percentBounds=this.percentBounds,t._color=this.color,t._templateModel=this.templateModel,t._cutted=this._cutted,t._selected=this._selected,t._pending=this._pending,t._fading=this._fading,t}},{key:"delete",value:function(){this.deleted$.next()}},{key:"refresh",value:function(){this.refresh$.next()}},{key:"idealBounds",get:function(){return new C.F(0,0,15,15)}},{key:"pixelBounds",set:function(e){C.F.equals(this._pixelBounds,e)||(this._pixelBounds=e,this.pixelBounds$.next(e))},get:function(){return this._pixelBounds}},{key:"percentBounds",set:function(e){this._percentBounds=e},get:function(){return this._percentBounds}},{key:"templateModel",set:function(e){this._templateModel=e},get:function(){return this._templateModel}},{key:"id",get:function(){return this._id}},{key:"isCutted",set:function(e){this._cutted!==e&&(this._cutted=e,this.cutted$.next(e))},get:function(){return this._cutted}},{key:"color",set:function(e){this._color=e},get:function(){return this._color}},{key:"isDragging",set:function(e){this._isDragging!==e&&(this._isDragging=e,this.dragging$.next(e))},get:function(){return this._isDragging}},{key:"isDropping",set:function(e){this._isDropping!==e&&(this._isDropping=e,this.dropping$.next(e))},get:function(){return this._isDropping}},{key:"isPressed",set:function(e){this._isPressed!==e&&(this._isPressed=e,this.pressed$.next(e))},get:function(){return this._isPressed}},{key:"isSelected",set:function(e){this._selected!==e&&(this._selected=e,this.selected$.next(e))},get:function(){return this._selected}},{key:"isHidden",set:function(e){this._isHidden!==e&&(this._isHidden=e,this.hidden$.next(e))},get:function(){return this._isHidden}},{key:"isPending",set:function(e){this._pending=e},get:function(){return this._pending}},{key:"fading",get:function(){return this._fading},set:function(e){this._fading=e}}]),e}()).currentId=0,ne),se=((te=function(){function e(t,n){_classCallCheck(this,e),this.changeDetectorRef=n,this.close=new p.EventEmitter,this.progressDiameter=100,this.subscriptions=[],this.element=t.nativeElement,this.element.setAttribute("hidden","0")}return _createClass(e,[{key:"ngOnDestroy",value:function(){this.subscriptions.forEach((function(e){return e.unsubscribe()}))}},{key:"designMode",set:function(e){this._designMode=Object(m.b)(e)},get:function(){return this._designMode}},{key:"tile",set:function(e){var t=this;if(this._tile=e,this.subscriptions.forEach((function(e){return e.unsubscribe()})),this.subscriptions=[],e){var n=function(e,n){n?t.element.setAttribute(e,n.toString()):t.element.removeAttribute(e)};e.fading&&(this.element.setAttribute("fading","0"),this.changeDetectorRef.markForCheck()),this.subscriptions.push(Object(B.a)(e.pixelBounds$).pipe(Object(R.a)((function(e){return!!e})),Object(z.a)(),Object(R.a)((function(){return e.fading})),Object(L.a)((function(){t.element.setAttribute("fading","1"),t.changeDetectorRef.markForCheck()})),Object(F.a)(200)).subscribe((function(){t.element.removeAttribute("fading"),t.changeDetectorRef.markForCheck()}))),this.subscriptions.push(Object(B.a)(e.pixelBounds$).pipe(Object(R.a)((function(e){return!!e}))).subscribe((function(n){e.isHidden||t.element.removeAttribute("hidden"),t.element.style.left=n.left+"px",t.element.style.top=n.top+"px",t.element.style.width=n.width+"px",t.element.style.height=n.height+"px",t.progressDiameter=Math.min(100,Math.round(Math.max(.4*n.width,.4*n.height))),t.changeDetectorRef.markForCheck()}))),this.subscriptions.push(Object(B.a)(e.pressed$).pipe(Object(L.a)((function(e){return n("pressed",e)}))).subscribe((function(){return t.changeDetectorRef.markForCheck()}))),this.subscriptions.push(Object(B.a)(e.selected$).pipe(Object(L.a)((function(e){return n("selected",e)}))).subscribe((function(){return t.changeDetectorRef.markForCheck()}))),this.subscriptions.push(Object(B.a)(e.dragging$).pipe(Object(L.a)((function(e){return n("drag",e)}))).subscribe((function(){return t.changeDetectorRef.markForCheck()}))),this.subscriptions.push(Object(B.a)(e.dropping$).pipe(Object(L.a)((function(e){return n("drop",e)}))).subscribe((function(){return t.changeDetectorRef.markForCheck()}))),this.subscriptions.push(Object(B.a)(e.cutted$).pipe(Object(L.a)((function(e){return n("cutted",e)}))).subscribe((function(){return t.changeDetectorRef.markForCheck()}))),this.subscriptions.push(Object(B.a)(e.deleted$).pipe(Object(L.a)((function(){return t.element.remove()}))).subscribe((function(){return t.changeDetectorRef.markForCheck()})));var i=Object(B.a)(e.hidden$).pipe(Object(L.a)((function(e){return n("hidden",e?"1":"2")})));this.subscriptions.push(i.pipe(Object(I.a)(1e3),Object(R.a)((function(e){return e})),Object(L.a)((function(){return t.element.setAttribute("hidden","0")}))).subscribe((function(){return t.changeDetectorRef.markForCheck()}))),this.subscriptions.push(i.pipe(Object(I.a)(1),Object(R.a)((function(e){return!e})),Object(L.a)((function(){return t.element.removeAttribute("hidden")}))).subscribe((function(){return t.changeDetectorRef.markForCheck()}))),this.subscriptions.push(Object(B.a)(e.refresh$).pipe(Object(I.a)(1)).subscribe((function(){return t.changeDetectorRef.markForCheck()})))}},get:function(){return this._tile}}]),e}()).\u0275fac=function(e){return new(e||te)(p["\u0275\u0275directiveInject"](p.ElementRef),p["\u0275\u0275directiveInject"](p.ChangeDetectorRef))},te.\u0275cmp=p["\u0275\u0275defineComponent"]({type:te,selectors:[["deja-tile"]],inputs:{designMode:"designMode",tile:"tile",template:"template"},outputs:{close:"close"},decls:2,vars:6,consts:[[3,"ngTemplateOutlet","ngTemplateOutletContext"],["mode","indeterminate","class","accent",3,"diameter",4,"ngIf"],["mode","indeterminate",1,"accent",3,"diameter"]],template:function(e,t){1&e&&(p["\u0275\u0275template"](0,N,0,0,"ng-template",0),p["\u0275\u0275template"](1,q,1,1,"mat-progress-spinner",1)),2&e&&(p["\u0275\u0275property"]("ngTemplateOutlet",t.template)("ngTemplateOutletContext",p["\u0275\u0275pureFunction2"](3,Y,t.tile,t.designMode)),p["\u0275\u0275advance"](1),p["\u0275\u0275property"]("ngIf",t.tile&&t.tile.isPending))},directives:[i.s,i.n,M],styles:['[_nghost-%COMP%]{display:block;position:absolute;transition-property:left,top,opacity;transition-duration:.5s;transition-timing-function:ease;opacity:1}[expanded][_nghost-%COMP%]{transition-property:height}[cutted][_nghost-%COMP%]{opacity:.5}[drag][_nghost-%COMP%], [drop][_nghost-%COMP%]{z-index:100}[drag][_nghost-%COMP%]{opacity:.5;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;transition:none}[fading="0"][_nghost-%COMP%]{opacity:0;transition:none}[fading="1"][_nghost-%COMP%]{opacity:0}[hidden="0"][_nghost-%COMP%]{visibility:hidden;transition:none}[hidden="1"][_nghost-%COMP%]{opacity:0;transition:opacity 1s ease-in-out}[hidden="2"][_nghost-%COMP%]{visibility:visible;opacity:0;transition:none}[_nghost-%COMP%]   mat-progress-spinner[_ngcontent-%COMP%]{position:absolute;z-index:1;right:.2rem;bottom:.2rem;transform:translate(-60%,-60%)}'],changeDetection:0}),te),ae=((ee=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var i;_classCallCheck(this,n),(i=t.call(this)).clipboardService=e,i.refreshTiles$=new E.a,i.ensureVisible$=new E.a,i.ensureBounds$=new E.a,i.dragging$=new P.a(!1),i.dragSelection$=new E.a,i.dragDropInfos$=new E.a,i.selectionRect$=new E.a,i.dragover$=new E.a,i.dragleave$=new E.a,i.deleteTiles$=new E.a,i.designMode=!1,i.layoutCompleted=new E.a,i.layoutChanged=new E.a,i.tilesAdded=new E.a,i.tilesDeleted=new E.a,i.selectionChanged=new E.a,i.contentAdding=new E.a,i.contentRemoving=new E.a,i._tileMinWidth=10,i._tileMinWidthUnit="%",i._tileMaxWidth=100,i._tileMaxWidthUnit="%",i._tileMinHeight=10,i._tileMinHeightUnit="%",i._tileMaxHeight=100,i._tileMaxHeightUnit="%",i._maxWidth=100,i._maxWidthUnit="%",i.tilesDic=new Map,i._targetBounds=new C.F,i.destination=new C.F,i.dragPageOffset=new C.E,i.dragOriginalPosition=new C.E,i.selectedIds=new Array,Object(B.a)(i.refreshTiles$).pipe(Object(I.a)(30),Object(L.a)((function(){i.container.style.width="",i.container.style.height=""})),Object(F.a)(10),Object(W.a)(i.destroyed$)).subscribe((function(e){var t,n,r,o=new Array,s=i.container.getBoundingClientRect();!(null===(t=e)||void 0===t?void 0:t.resetWidth)&&i.hundredPercentWith||(i.hundredPercentWith=s.width);var a=s.height-20,c=s.width-20,l=0,d=0,u=i.tiles||new Array,h=new Array;u.forEach((function(e){if(e.percentBounds&&!e.percentBounds.isEmpty()){var t=i.getPixelBounds(e.percentBounds);t.bottom>l&&(l=t.right),t.right>d&&(d=t.bottom),e.isDragging||(e.pixelBounds=t)}else o.push(e);e.isSelected&&!e.isHidden&&h.push(e.id),e.pixelBounds&&e.pixelBounds.bottom>a&&(a=e.pixelBounds.bottom)}));var f=d,p=0;if(o.forEach((function(e){e.percentBounds=e.percentBounds||new C.F(i.getPercentSize(p),i.getPercentSize(f),3*i.getTileMinPercentWidth(),3*i.getTileMinPercentHeight());var t=i.getPixelBounds(e.percentBounds);t.right>c&&(f=d,p=0,e.percentBounds.left=0,e.percentBounds.top=i.getPercentSize(f),t=i.getPixelBounds(e.percentBounds)),t.bottom>d&&(d=t.bottom),e.pixelBounds=i.getPixelBounds(e.percentBounds),p+=t.width})),i.dragTarget){var g=i.getPixelBounds(i.dragTarget);a<=g.bottom&&(a=g.bottom+g.height),c<=g.right&&(c=g.right+g.width)}var m=i.getPixelSize(2*i._tileMinHeight,i._tileMinHeightUnit);a<m&&(a=m),i.container.style.width=c+"px",i.container.style.height=a+"px",(null===(n=e)||void 0===n?void 0:n.ensureVisible)&&i.ensureVisible$.next(e.ensureVisible),(null===(r=e)||void 0===r?void 0:r.ensureBounds)&&i.ensureBounds$.next(e.ensureBounds),i.selectedTiles=h;var v=new CustomEvent("DejaTilesEvent",{cancelable:!1});o.length>0&&(v.tiles=o,i.layoutChanged.next(v)),v.tiles=u,i.layoutCompleted.next(v)}));var r=Object(B.a)(i.ensureVisible$).pipe(Object(F.a)(1),Object(H.a)((function(e){return i.tilesDic.get(e)})),Object(R.a)((function(e){return!!e})),Object(H.a)((function(e){return e.percentBounds})));Object(S.a)(i.ensureBounds$,r).pipe(Object(W.a)(i.destroyed$)).subscribe((function(e){var t=i.getPixelBounds(e),n=t.left,r=t.right,o=t.top,s=t.bottom,a=function(e){for(;e&&"DEJA-TILES"!==e.tagName;)e=e.parentElement;return e}(i.container);if(a){var c=i.container.getBoundingClientRect(),l=a.getBoundingClientRect();n+c.left<l.bottom?a.scrollLeft+=n+c.left-l.bottom:r+c.left>l.right&&(a.scrollLeft+=r+c.left-l.right),o+c.top<l.top?a.scrollTop+=o+c.top-l.top:s+c.top>l.bottom&&(a.scrollTop+=s+c.top-l.bottom)}})),Object(B.a)(i.dragSelection$).pipe(Object(V.a)((function(e){var t=Object(D.a)(i._container.ownerDocument,"mouseup").pipe(Object(L.a)((function(){return i.selectionRect$.next(null)})));return Object(D.a)(i._container,"mousemove").pipe(Object(W.a)(t),Object(R.a)((function(e){return 1===e.buttons})),Object(L.a)((function(t){var n=i._container.getBoundingClientRect();e.selectedRect=C.F.fromPoints(e.startPosition,new C.E(t.pageX-n.left,t.pageY-n.top)),i.selectionRect$.next(e.selectedRect);var r=i.HitTest(e.selectedRect);i.selectedTiles=r.map((function(e){return e.id}))})))})),Object(W.a)(i.destroyed$)).subscribe();var o=Object(B.a)(i.dragleave$);return Object(B.a)(i.dragDropInfos$).pipe(Object(V.a)((function(e){var t=e&&(e.tiles&&e.tiles.length&&e.tiles||e.currentTile&&[e.currentTile]);if(!t)return Object($.a)(null);var n=!e.tiles,r=Object(D.a)(i._container,"mousemove"),s=Object(D.a)(i._container.ownerDocument,"keyup").pipe(Object(R.a)((function(e){return e.code===C.A.Escape}))),a=r.pipe(Object(R.a)((function(e){return 1!==e.buttons}))),c=Object(S.a)(o,a,s).pipe(Object(L.a)((function(){i.removeTemporaryTile(),i.cancelDrag(t)}))),l=Object(D.a)(i._container.ownerDocument,"mouseup").pipe(Object(L.a)((function(){return i.drop(t)}))),d=Object(S.a)(l,c),u=Object(B.a)(i.dragover$).pipe(Object(H.a)((function(e){return e.originalEvent})));return Object(S.a)(r,u).pipe(Object(W.a)(d),Object(L.a)((function(r){var o=i._container.getBoundingClientRect(),s=r.pageX-o.left,a=r.pageY-o.top;if(e.enabled)i.drag(t,s,a);else if(Math.abs(e.startX-s)>=15||Math.abs(e.startY-a)>=15)if(n){var c=e.currentTile;i.selectedTiles=[c.id];var l=c.percentBounds;l&&!l.isEmpty()||(l=new C.F(0,0,15,15));var d=i.getFreePlace(new C.F(i.getPercentSize(s)-l.width/2,i.getPercentSize(a)-l.height/2,l.width,l.height));e.startX=d.left-l.width/2,e.startY=d.top-l.height/2,c.percentBounds=d,c.dragging$.next(!0),i._cursor="move",i.tiles.push(c),i.tilesDic.set(c.id,c),i.dragging$.next(!0),e.enabled=!0,i.startDrag(t,i.getPixelSize(d.left+d.width/2),i.getPixelSize(d.top+d.height/2))}else i.dragging$.next(!0),e.enabled=!0,i.startDrag(t,e.startX,e.startY)})))})),Object(W.a)(i.destroyed$)).subscribe(),Object(B.a)(i.deleteTiles$).pipe(Object(W.a)(i.destroyed$)).subscribe((function(e){return i.deleteTiles(e)})),i}return _createClass(n,[{key:"copySelection",value:function(){var e=this.tiles.filter((function(e){return e.isSelected}));return e.length&&this.copyTiles(e,!1),e}},{key:"cutSelection",value:function(){var e=this.tiles.filter((function(e){return e.isSelected}));return e.length&&this.copyTiles(e,!0),e}},{key:"deleteSelection",value:function(){var e=this.tiles.filter((function(e){return e.isSelected}));return e.length&&this.removeTiles(e.map((function(e){return e.id}))),e}},{key:"paste",value:function(){if(!this.clipboardService||!this.clipboardService.isAvailable("tiles"))return new Array;var e,t=this.clipboardService.get("tiles");this.tiles.forEach((function(e){return e.isSelected=!1})),t.forEach((function(t){e=e?C.F.union(e,t.percentBounds):new C.F(t.percentBounds)}));var n=this.getFreePlace(new C.F(0,0,e.width,e.height)),i=t.map((function(t){var i=t.clone();return i.percentBounds=new C.F(n.left+t.percentBounds.left-e.left,n.top+t.percentBounds.top-e.top,t.percentBounds.width,t.percentBounds.height),i.isSelected=!0,i}));return this.addTiles(i),i}},{key:"getTileElementFromHTMLElement",value:function(e){for(var t=e;t&&"DEJA-TILE"!==t.tagName;)if((t=t.parentElement)===this.container)return;return t}},{key:"isElementInsideDejaEditor",value:function(e){for(var t=e;t&&t!==this.container;){if("DEJA-EDITOR"===t.tagName)return!0;t=t.parentElement}return!1}},{key:"getTileComponentFromHTMLElement",value:function(e){var t=this.getTileElementFromHTMLElement(e);return t&&this.tilesDic.get(t.id)}},{key:"deleteTiles",value:function(e){var t=this;if(e&&0!==e.length){var n=new CustomEvent("DejaTilesDeletedEvent",{cancelable:!1});n.tiles=e,e.forEach((function(e){t.tilesDic.delete(e.id),e.delete()}));for(var i=this.tiles.length;--i>=0;)this.tilesDic.has(this.tiles[i].id)||this.tiles.splice(i,1);this.refreshTiles$.next({resetWidth:!0}),n.tiles=this.tiles,this.tilesDeleted.next(n)}}},{key:"removeTiles",value:function(e){var t=this;if(e&&0!==e.length){var n=e.map((function(e){return t.tilesDic.get(e)}));n.forEach((function(e){e.isHidden=!0}));var i=new CustomEvent("DejaTilesRemoveEvent",{cancelable:!0});i.tiles=this.tiles,i.removed=n,i.cancel$=new E.a;var r=i.cancel$.pipe(Object(z.a)(),Object(W.a)(this.destroyed$)).subscribe((function(e){e?n.forEach((function(e){return e.isHidden=!1})):t.deleteTiles(n)}));this.contentRemoving.next(i),i.defaultPrevented||(r.unsubscribe(),this.deleteTiles(n))}}},{key:"getFreePlace",value:function(e){var t=new Array,n=this.tiles.filter((function(e){return!e.isDragging})),i=0;n.forEach((function(e){e.percentBounds.bottom>i&&(i=e.percentBounds.bottom)}));for(var r=0;r<=this._maxWidth-e.width;r+=this._tileMinWidth)for(var o=function(i){var o=new C.F(r,i,e.width,e.height);n.find((function(e){return e.percentBounds.intersectWith(o)}))||t.push(o)},s=0;s<=i-e.height;s+=this._tileMinHeight)o(s);return t.length>0?(t.sort((function(t,n){var i=function(t){return Math.min(Math.abs(t.left-e.left),Math.abs(t.right-e.right))+200*Math.min(Math.abs(t.top-e.top),Math.abs(t.bottom-e.bottom))};return i(t)-i(n)})),t[0]):new C.F(0,i,e.width,e.height)}},{key:"moveTile",value:function(e,t){var n=this.tiles.find((function(t){return t.id===e}));n&&(n.percentBounds=t,this.refreshTiles$.next())}},{key:"HitTest",value:function(e){var t=new C.F(this.getPercentSize(e.left),this.getPercentSize(e.top),this.getPercentSize(e.width),this.getPercentSize(e.height));return this.tiles.filter((function(e){return e.percentBounds.intersectWith(t)}))}},{key:"getPercentSize",value:function(e){return Math.round(100*e/this.hundredPercentWith)}},{key:"dragEnter",value:function(e,t){if(!this.designMode||!this._container)return!1;var n=e.DejaTile;if(!n)return!1;var i=this._container.getBoundingClientRect(),r=t.originalEvent,o=r.pageX,s=r.pageY,a=o-i.left,c=s-i.top,l=n.clone();return l.isTemporary=!0,this.dragDropInfos$.next({enabled:!1,startX:a,startY:c,currentTile:l}),!0}},{key:"startDrag",value:function(e,t,n){var i,r=this,o=this.saveLayout();e.forEach((function(e){i=i?C.F.union(i,e.percentBounds):e.percentBounds,e.isDragging=!0})),this.dragRelativePosition=new Map,e.forEach((function(e){return r.dragRelativePosition.set(e.id,new C.E(e.percentBounds.left-i.left,e.percentBounds.top-i.top))})),this.dragPageOffset=new C.E(t,n),this.dragOriginalPosition=new C.E(i.left,i.top),this.targetBounds=o.targetBounds=o.validBounds=i,this.originalLayout=o,this.validLayout=void 0}},{key:"cancelDrag",value:function(e){this.clearMoveTimer(),Object(B.a)(e).pipe(Object(R.a)((function(e){return!!e})),Object(W.a)(this.destroyed$)).subscribe((function(e){e.isDragging=!1,e.isDropping=!0})),this.originalLayout&&this.restoreLayout(this.originalLayout),this.endDrag()}},{key:"drop",value:function(e){var t,n=this;if(this.clearMoveTimer(),this.validLayout){if(this.restoreLayout(this.validLayout),"move"!==this._cursor){var i=e[0];i.percentBounds=new C.F(this.validLayout.validBounds),i.isDragging=!1}else Object(B.a)(e).pipe(Object(R.a)((function(e){return!!e})),Object(L.a)((function(e){var t=n.validLayout.validBounds.left+n.dragRelativePosition.get(e.id).left,i=n.validLayout.validBounds.top+n.dragRelativePosition.get(e.id).top;e.percentBounds=new C.F(t,i,e.percentBounds.width,e.percentBounds.height),e.isDragging=!1,e.isDropping=!0,e.isTemporary&&(n.tilesDic.delete(e.id),e.makeId(),n.tilesDic.set(e.id,e),n.addTiles([e]))})),Object(F.a)(1e3),Object(W.a)(this.destroyed$)).subscribe((function(e){return e.isDropping=!1}));t=this.tiles.filter((function(e){var t;return!C.F.equals(e.percentBounds,null===(t=n.originalLayout[e.id])||void 0===t?void 0:t.bounds)})),this.endDrag()}else this.removeTemporaryTile(),this.cancelDrag(e);if(t){var r=new CustomEvent("DejaTilesEvent",{cancelable:!0});r.tiles=this.tiles,this.layoutChanged.next(r)}return t}},{key:"endDrag",value:function(){this.originalLayout=void 0,this.validLayout=void 0,this.targetBounds=void 0,this.dragging$.next(!1),this.dragDropInfos$.next(null),this.dragTarget=void 0,this.copyTiles(null),this.refreshTiles$.next()}},{key:"drag",value:function(e,t,n){var i=this,r=new C.E(t-this.dragPageOffset.left,n-this.dragPageOffset.top),o=r.left+this.getPixelSize(this.dragOriginalPosition.left),s=r.top+this.getPixelSize(this.dragOriginalPosition.top),a=this.getTileMinPixelSize(),c=this.getTileMaxPixelSize();if("move"!==this._cursor){var l=e[0],d=this.getPixelBounds(l.percentBounds),u=o+d.width,h=s+d.height,f=d.right,p=d.bottom;switch(this._cursor){case"nw-resize":d.left=Math.max(Math.min(o,d.right-a.width),d.right-c.width),d.right=f,d.top=Math.max(Math.min(s,d.bottom-a.height),d.bottom-c.height),d.bottom=p,this.size(l,new C.E(o,s),C.u.left+C.u.top);break;case"sw-resize":d.left=Math.max(Math.min(o,d.right-a.width),d.right-c.width),d.right=f,d.bottom=Math.max(Math.min(h,d.top+c.height),d.top+a.height),this.size(l,new C.E(o,h),C.u.left+C.u.bottom);break;case"w-resize":d.left=Math.max(Math.min(o,d.right-a.width),d.right-c.width),d.right=f,this.size(l,new C.E(o,0),C.u.left);break;case"ne-resize":d.right=Math.max(Math.min(u,d.left+c.width),d.left+a.width),d.top=Math.max(Math.min(s,d.bottom-a.height),d.bottom-c.height),d.bottom=p,this.size(l,new C.E(u,s),C.u.right+C.u.top);break;case"se-resize":d.right=Math.max(Math.min(u,d.left+c.width),d.left+a.width),d.bottom=Math.max(Math.min(h,d.top+c.height),d.top+a.height),this.size(l,new C.E(u,h),C.u.right+C.u.bottom);break;case"e-resize":d.right=Math.max(Math.min(u,d.left+c.width),d.left+a.width),this.size(l,new C.E(u,0),C.u.right);break;case"n-resize":d.top=Math.max(Math.min(s,d.bottom-a.height),d.bottom-c.height),d.bottom=p,this.size(l,new C.E(0,s),C.u.top);break;case"s-resize":d.bottom=Math.max(Math.min(h,d.top+c.height),d.top+a.height),this.size(l,new C.E(0,h),C.u.bottom)}l.pixelBounds=d}else e.forEach((function(e){e.pixelBounds=new C.F(o+i.getPixelSize(i.dragRelativePosition.get(e.id).left),s+i.getPixelSize(i.dragRelativePosition.get(e.id).top),i.getPixelSize(e.percentBounds.width),i.getPixelSize(e.percentBounds.height))})),this.dragTarget=new C.F(this.getPercentSize(o),this.getPercentSize(s),this.targetBounds.width,this.targetBounds.height),this.move()}},{key:"addTiles",value:function(e){var t,n=this;if(e&&0!==e.length){e.forEach((function(e){n.tiles.find((function(t){return t.id===e.id}))||(n.tiles.find((function(t){var n;return e.percentBounds&&(null===(n=t.percentBounds)||void 0===n?void 0:n.intersectWith(e.percentBounds))}))&&(e.percentBounds=void 0),e.percentBounds||(e.percentBounds=n.getFreePlace(e.idealBounds)),n.tiles.push(e),n.tilesDic.set(e.id,e))}));var i=new CustomEvent("DejaTilesAddEvent",{cancelable:!0});i.tiles=this.tiles,i.added=e,i.cancel$=new E.a;var r,o=null===(t=this.clipboardService)||void 0===t?void 0:t.get("tiles-provider");o&&(r=this.clipboardService.get("tiles")).forEach((function(e){e.isHidden=!0}));var s,a=function(e){r&&(o.next(r),n.clipboardService.clear());var t=new CustomEvent("DejaTileAddedEvent",{cancelable:!1});t.tiles=n.tiles,t.added=e,n.tilesAdded.next(t)};e.forEach((function(e){s=s?C.F.union(s,e.percentBounds):new C.F(e.percentBounds)})),this.refreshTiles$.next({ensureBounds:s}),this.contentAdding.next(i),i.defaultPrevented?(i.cancel$.pipe(Object(U.a)(1),Object(R.a)((function(e){return!e})),Object(W.a)(this.destroyed$)).subscribe(a),i.cancel$.pipe(Object(U.a)(1),Object(R.a)((function(e){return!!e})),Object(V.a)((function(){return r&&r.forEach((function(e){e.isHidden=!1,e.isCutted=!0})),Object(B.a)(e)})),Object(L.a)((function(e){return e.isHidden=!0})),Object(F.a)(1e3),Object(X.a)((function(e,t){return Object(f.c)(e,[t])}),new Array),Object(U.a)(1),Object(W.a)(this.destroyed$)).subscribe((function(e){return n.deleteTiles(e)}))):a(e)}}},{key:"size",value:function(e,t,n){var i,r,o,s,a=new C.E(this.getPercentSize(t.left),this.getPercentSize(t.top)),c=e.percentBounds.clone(),l=e.percentBounds.clone();if(n&C.u.left){i=this.getTileMinPercentWidth(),o=this.getTileMaxPercentWidth();var d=a.left,u=c.left<d?i*Math.ceil(d/i):i*Math.floor(d/i),h=Math.min(o,Math.max(i,l.right-u));c.width=c.right-d,c.left=d,l.left=l.right-h,l.width=h}if(n&C.u.right){i=i||this.getTileMinPercentWidth(),o=o||this.getTileMaxPercentWidth();var f=a.left,p=c.right<f?i*Math.ceil(f/i):i*Math.floor(f/i);c.width=f-c.left,l.width=Math.min(o,Math.max(i,p-l.left))}if(n&C.u.top){r=this.getTileMinPercentHeight(),s=this.getTileMaxPercentHeight();var g=a.top,m=c.top<g?r*Math.ceil(g/r):r*Math.floor(g/r),v=Math.min(s,Math.max(r,l.bottom-m));c.height=c.bottom-g,c.top=g,l.top=l.bottom-v,l.height=v}if(n&C.u.bottom){r=r||this.getTileMinPercentHeight(),s=s||this.getTileMaxPercentHeight();var b=a.top,y=c.bottom<b?r*Math.ceil(b/r):r*Math.floor(b/r);c.height=b-c.top,l.height=Math.min(s,Math.max(r,y-l.top))}if(!C.F.equals(l,this.destination))if(this.restoreLayout(this.originalLayout),this.destination=l.clone(),this.tiles.find((function(e){return!e.isDragging&&e.percentBounds.intersectWith(l)}))){if(l){var x=this.ensureTarget(l,c,n);x&&(this.targetBounds=x,this.validLayout=this.saveLayout(),this.validLayout.targetBounds=l,this.validLayout.validBounds=x,this.refreshTiles$.next())}}else this.targetBounds=l,this.validLayout=this.saveLayout(),this.validLayout.targetBounds=this.validLayout.validBounds=l,this.refreshTiles$.next()}},{key:"clearMoveTimer",value:function(){this.moveTimOut&&(this.moveTimOut.unsubscribe(),this.moveTimOut=void 0)}},{key:"move",value:function(){var e=this,t=this.getTileMinPercentWidth(),n=this.getTileMinPercentHeight(),i=this.ensureContainer(new C.F(t*Math.round(this.dragTarget.left/t),n*Math.round(this.dragTarget.top/n),this.dragTarget.width,this.dragTarget.height));if(!(this.lastTargetBounds&&Math.abs(i.left-this.lastTargetBounds.left)<t&&Math.abs(i.top-this.lastTargetBounds.top)<n)){this.lastTargetBounds=i;var r=this.tiles.filter((function(e){return!e.isDragging})).reduce((function(e,t){var n=C.F.overlapInfos(t.percentBounds,i);return Math.max(Math.min(n.height,n.width),e)}),0);if(this.tiles.find((function(t){var n;return null===(n=e.originalLayout[t.id])||void 0===n?void 0:n.bounds.intersectWith(i)}))||this.restoreLayout(this.originalLayout),0===r)this.clearMoveTimer(),this.targetBounds=i.clone(),this.destination=i.clone(),this.validLayout=this.saveLayout(),this.validLayout.targetBounds=this.validLayout.validBounds=i,this.refreshTiles$.next();else{if(C.F.equals(this.targetBounds,i)||this.clearMoveTimer(),r>3){var o=i.clone();this.moveTimOut=Object(A.a)(500).pipe(Object(U.a)(1),Object(W.a)(this.destroyed$)).subscribe((function(){e.restoreLayout(e.originalLayout),e.destination=o;var t=e.ensureTarget(o,e.dragTarget,C.u.all);t&&(e.targetBounds=t,e.validLayout=e.saveLayout(),e.validLayout.targetBounds=o,e.validLayout.validBounds=t,e.refreshTiles$.next())}))}for(var s=new Array,a=this.tiles.filter((function(e){return!e.isDragging})),c=Math.min(this.targetBounds.left,i.left);c<=Math.max(this.targetBounds.left,i.left);c++)for(var l=function(e){var t=new C.F(c,e,i.width,i.height);a.find((function(e){return e.percentBounds.intersectWith(t)}))||s.push(t)},d=Math.min(this.targetBounds.top,i.top);d<=Math.max(this.targetBounds.top,i.top);d++)l(d);s.length>0&&(s.sort((function(e,t){var n=function(e){return Math.min(Math.abs(e.left-i.left),Math.abs(e.right-i.right))+200*Math.min(Math.abs(e.top-i.top),Math.abs(e.bottom-i.bottom))};return n(e)-n(t)})),i=s[0],this.targetBounds=i.clone(),this.destination=i.clone(),this.validLayout=this.saveLayout(),this.validLayout.targetBounds=this.validLayout.validBounds=i,this.refreshTiles$.next())}}}},{key:"ensureContainer",value:function(e){e.left<0&&(e=e.offset(-e.left,0)),e.top<0&&(e=e.offset(0,-e.top));var t=this.getMaxPercentWidth();t&&e.right>t&&(e=e.offset(t-e.right,0));var n=this.getMaxPercentHeight();return n&&e.bottom>n&&(e=e.offset(0,n-e.bottom)),e}},{key:"ensureTarget",value:function(e,t,n,i){var r=this,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10;t||(t=e),i||(i=e.clone()),n||(n=C.u.all);var s=new Array,a=new Array,c=new Array,l=new Array;if(this.tiles.filter((function(t){return!t.isDragging&&t.percentBounds.intersectWith(e)})).find((function(i){var o=new C.F(r.dragOriginalPosition.left,r.dragOriginalPosition.top,e.width,e.height);if(Math.abs(i.percentBounds.left-t.left)<1&&Math.abs(i.percentBounds.top-t.top)<1&&Math.abs(i.percentBounds.width-t.width)<1&&Math.abs(i.percentBounds.height-t.height)<1&&(Math.abs(t.left-o.right)<=4||Math.abs(t.right-o.left)<=4||Math.abs(t.top-o.bottom)<=4||Math.abs(t.bottom-o.top)<=4))return i.percentBounds=o,!0;var d,u=i.percentBounds.left-t.left,h=t.right-i.percentBounds.right,f=i.percentBounds.top-t.top,p=t.bottom-i.percentBounds.bottom,g=Math.max(0,Math.min(i.percentBounds.right,t.right)-Math.max(i.percentBounds.left,t.left))/Math.min(i.percentBounds.width,t.width);switch(Math.max(0,Math.min(i.percentBounds.bottom,t.bottom)-Math.max(i.percentBounds.top,t.top))/Math.min(i.percentBounds.height,t.height)>=g&&n&C.u.horizontal?d=h>=u&&n&C.u.left?C.u.left:C.u.right:n&C.u.vertical&&(d=p>=f&&n&C.u.top?C.u.top:C.u.bottom),d){case C.u.left:s.push(i);break;case C.u.top:c.push(i);break;case C.u.right:a.push(i);break;default:l.push(i)}})))return e;var d=0;return s.length&&(d=this.pushHorizontal(e,-1,s))?(e=this.ensureContainer(e.offset(d,0)),o?this.ensureTarget(e,t,n&~C.u.left,i,o-1):null):(a.length&&(d=this.pushHorizontal(e,1,a)),d>0?(this.restoreLayout(this.originalLayout),o?this.ensureTarget(i,t,n&C.u.vertical,void 0,o-1):null):c.length&&(d=this.pushVertical(e,-1,c))?(e=this.ensureContainer(e.offset(0,d)),o?this.ensureTarget(e,t,C.u.bottom,void 0,o-1):null):(d=this.pushVertical(e,1,l))?null:e)}},{key:"saveLayout",value:function(){var e=this,t={};return t.height=this.getTileMinPercentHeight(),this.tiles.forEach((function(n){var i=e.getPixelSize(n.percentBounds.top||0),r=e.getPixelSize(n.percentBounds.height||e._tileMinHeight);i+r>t.height&&(t.height=i+r),t[n.id]={bounds:n.percentBounds.clone(),id:n.id}})),t}},{key:"getPixelBounds",value:function(e){return C.F.fromLTRB(Math.round(e.left*this.hundredPercentWith/100),Math.round(e.top*this.hundredPercentWith/100),Math.round(e.right*this.hundredPercentWith/100),Math.round(e.bottom*this.hundredPercentWith/100))}},{key:"getPixelSize",value:function(e,t){return t&&"%"!==t?e:Math.round(e*this.hundredPercentWith/100)}},{key:"getSizePercentLimit",value:function(e){var t=this[e+"Unit"];return t&&"px"!==t?this[e]:this.getPercentSize(this[e])}},{key:"getSizePixelLimit",value:function(e){var t=this[e+"Unit"];return t&&"px"!==t?this.getPixelSize(this[e]):this[e]}},{key:"getTileMinPixelSize",value:function(){return new C.H(this.getSizePixelLimit("_tileMinWidth"),this.getSizePixelLimit("_tileMinHeight"))}},{key:"getTileMaxPixelSize",value:function(){return new C.H(this.getSizePixelLimit("_tileMaxWidth"),this.getSizePixelLimit("_tileMaxHeight"))}},{key:"getTileMinPercentWidth",value:function(){return Math.max(1,this.getSizePercentLimit("_tileMinWidth"))}},{key:"getTileMaxPercentWidth",value:function(){return Math.max(5,this.getSizePercentLimit("_tileMaxWidth"))}},{key:"getTileMinPercentHeight",value:function(){return Math.max(1,this.getSizePercentLimit("_tileMinHeight"))}},{key:"getTileMaxPercentHeight",value:function(){return Math.max(5,this.getSizePercentLimit("_tileMaxHeight"))}},{key:"getMaxPercentWidth",value:function(){return Math.max(5,this.getSizePercentLimit("_maxWidth"))}},{key:"getMaxPercentHeight",value:function(){return Math.max(5,this.getSizePercentLimit("_maxHeight"))}},{key:"getCursorFromHTMLElement",value:function(e,t,n){var i=this.getTileElementFromHTMLElement(n);if(!i)return null;var r=i.getBoundingClientRect();return e<r.left+15?t<r.top+15?"nw-resize":t>r.bottom-15?"sw-resize":"w-resize":e>r.right-15?t<r.top+15?"ne-resize":t>r.bottom-15?"se-resize":"e-resize":t<r.top+15?"n-resize":t>r.bottom-15?"s-resize":"move"}},{key:"extractValueAndUnit",value:function(e,t){var n,i=/(\d+)(.*)/i.exec(t);(null===(n=i)||void 0===n?void 0:n.length)>=1&&(this[e]=parseInt(i[1],10),this[e+"Unit"]=i.length>=2?i[2]:"px")}},{key:"restoreLayout",value:function(e){this.tiles.forEach((function(t){var n=e[t.id];n&&(t.percentBounds=n.bounds.clone())}))}},{key:"calcHorizontalOverflow",value:function(e,t,n,i){var r=this,o=0;return i=i||new Set,t.forEach((function(t){if(!i.has(t.id)){i.add(t.id);var s=t.percentBounds.offset(e*n,0),a=0,c=r.getMaxPercentWidth();s.left<0?a=-s.left:c&&s.right>c&&(a=s.right-c);var l=r.tiles.filter((function(e){return!e.isDragging&&!e.equalsTo(t)&&e.percentBounds.intersectWith(s)}));l.length&&(a+=r.calcHorizontalOverflow(e,l,n,i)),a>o&&(o=a)}})),o}},{key:"moveHorizontal",value:function(e,t,n,i){var r=this;t.forEach((function(t){if(!i.has(t.id)){var o=t.percentBounds.offset(e*n,0);i.set(t.id,o);var s=r.tiles.filter((function(e){return!e.isDragging&&!e.equalsTo(t)&&e.percentBounds.intersectWith(o)}));s.length&&r.moveHorizontal(e,s,n,i)}}))}},{key:"pushHorizontal",value:function(e,t,n,i){var r=0,o=new Map;return i||(i=0,n.forEach((function(n){var r=t>0?Math.max(0,e.right-n.percentBounds.left):Math.max(0,n.percentBounds.right-e.left);r>i&&(i=r)}))),i>0&&(r=this.calcHorizontalOverflow(t,n,i),(i-=r)>0&&(this.moveHorizontal(t,n,i,o),this.tiles.forEach((function(e){o.has(e.id)&&(e.percentBounds=o.get(e.id))})))),r}},{key:"calcVerticalOverflow",value:function(e,t,n,i){var r=this,o=0;return i=i||new Set,t.forEach((function(t){if(!i.has(t.id)){i.add(t.id);var s=t.percentBounds.offset(0,e*n),a=0,c=r.getMaxPercentHeight();s.top<0?a=-s.top:c&&s.bottom>c&&(a=s.bottom-c);var l=r.tiles.filter((function(e){return!e.isDragging&&!e.equalsTo(t)&&e.percentBounds.intersectWith(s)}));l.length&&(a+=r.calcVerticalOverflow(e,l,n,i)),a>o&&(o=a)}})),o}},{key:"moveVertical",value:function(e,t,n,i){var r=this;t.forEach((function(t){if(!i.has(t.id)){var o=t.percentBounds.offset(0,e*n);i.set(t.id,o);var s=r.tiles.filter((function(e){return!e.isDragging&&!e.equalsTo(t)&&e.percentBounds.intersectWith(o)}));s.length&&r.moveVertical(e,s,n,i)}}))}},{key:"pushVertical",value:function(e,t,n,i){var r=0,o=new Map;return i||(i=0,n.forEach((function(n){var r=t>0?Math.max(0,e.bottom-n.percentBounds.top):Math.max(0,n.percentBounds.bottom-e.top);r>i&&(i=r)}))),i>0&&(r=this.calcVerticalOverflow(t,n,i),(i-=r)>0&&(this.moveVertical(t,n,i,o),this.tiles.forEach((function(e){return o.has(e.id)&&(e.percentBounds=o.get(e.id))})))),r}},{key:"copyTiles",value:function(e,t){if(!this.clipboardService){if(!e)return;throw new Error("DejaClipboardService must be imported by your application to use the copyTiles methode of DejaTilesComponent.")}var n=this.clipboardService.get("tiles");n&&n.forEach((function(e){return e.isCutted=!1})),this.clipboardService.set("tiles",e),t?(e.forEach((function(e){return e.isCutted=!0})),this.clipboardService.set("tiles-provider",this.deleteTiles$)):this.clipboardService.set("tiles-provider",void 0)}},{key:"removeTemporaryTile",value:function(){for(var e=this.tiles.length;--e>=0;){var t=this.tiles[e];t.isTemporary&&(this.tilesDic.delete(t.id),this.tiles.splice(e,1))}}},{key:"container",set:function(e){var t=this;if(this._container=e,this._container){var n=Object(D.a)(e,"mouseleave"),i=Object(D.a)(e.ownerDocument,"mouseup"),r=Object(D.a)(e,"mouseenter");r.pipe(Object(V.a)((function(){if(t.designMode){var i=n.pipe(Object(L.a)((function(){return t.container.style.cursor=""})));return Object(D.a)(e,"mousemove").pipe(Object(W.a)(i),Object(R.a)((function(e){return!!t.container&&0===e.buttons})),Object(H.a)((function(e){return t._cursor=t.getCursorFromHTMLElement(e.pageX,e.pageY,e.target)})))}return Object($.a)("")})),Object(W.a)(this.destroyed$)).subscribe((function(e){return t.container.style.cursor=e})),r.pipe(Object(V.a)((function(){return Object(D.a)(e,"mousedown").pipe(Object(R.a)((function(e){return 1===e.buttons})),Object(R.a)((function(e){return!t.isElementInsideDejaEditor(e.target)})),Object(H.a)((function(e){return{event:e,clickedTile:t.getTileComponentFromHTMLElement(e.target)}}))).pipe(Object(W.a)(n),Object(V.a)((function(e){var n=e.event,r=e.clickedTile,o=n.target;if(t.currentTile&&(t.currentTile.isPressed=!1),t.currentTile=r,t.currentTile){if(t.currentTile.isPressed=!0,n.ctrlKey);else if(t.currentTile.isSelected&&"move"===t._cursor||(t.selectedTiles=[t.currentTile.id]),t.designMode){var s=t._container.getBoundingClientRect();t.dragDropInfos$.next({enabled:!1,startX:n.pageX-s.left,startY:n.pageY-s.top,currentTile:t.currentTile,tiles:t.tiles.filter((function(e){return e.isSelected}))})}return i.pipe(Object(U.a)(1),Object(R.a)((function(){return!!t.currentTile})))}if(o===t.container||o.parentElement===t.container){if(1===n.buttons){var a=t._container.getBoundingClientRect();t.dragSelection$.next({startPosition:new C.E(n.pageX-a.left,n.pageY-a.top),selectedRect:new C.F})}t.currentTile&&(t.currentTile.isPressed=!1),t.selectedTiles=[]}return Object($.a)(null)})))})),Object(R.a)((function(e){return!!e})),Object(W.a)(this.destroyed$)).subscribe((function(e){t.currentTile.isPressed&&(t.currentTile.isPressed=!1,e.ctrlKey&&(t.currentTile.isSelected=!t.currentTile.isSelected,t.selectedTiles=t.tiles.filter((function(e){return e.isSelected})).map((function(e){return e.id})))),t.designMode&&(t._cursor=t.getCursorFromHTMLElement(e.pageX,e.pageY,e.target),t.container.style.cursor=t._cursor),t.currentTile=void 0}))}},get:function(){return this._container}},{key:"tiles",set:function(e){this._tiles=e,this.tilesDic=this.tiles.reduce((function(e,t){return e.set(t.id,t)}),new Map),this.refreshTiles$.next({resetWidth:!0})},get:function(){return this._tiles||(this._tiles=new Array)}},{key:"selectedTiles",set:function(e){var t,n=new Array,i=!1,r=e.reduce((function(e,t){return e.add(t)}),new Set),o=this.selectedIds.reduce((function(e,t){return e.add(t)}),new Set);if((null===(t=this.tiles)||void 0===t?void 0:t.length)?this.tiles.forEach((function(e){r.has(e.id)!==o.has(e.id)&&(i=!0),e.isSelected=r.has(e.id),e.isSelected&&n.push(e)})):i=this.selectedIds.length>0,this.selectedIds=e,i){var s=new CustomEvent("DejaTilesAddEvent",{cancelable:!1});s.tiles=n,this.selectionChanged.next(s)}}},{key:"tileMinWidth",set:function(e){this.extractValueAndUnit("_tileMinWidth",e)}},{key:"tileMaxWidth",set:function(e){this.extractValueAndUnit("_tileMaxWidth",e)}},{key:"tileMinHeight",set:function(e){this.extractValueAndUnit("_tileMinHeight",e)}},{key:"tileMaxHeight",set:function(e){this.extractValueAndUnit("_tileMaxHeight",e)}},{key:"maxWidth",set:function(e){this.extractValueAndUnit("_maxWidth",e)}},{key:"targetBounds",get:function(){return this._targetBounds},set:function(e){this._targetBounds=e,e?this.selectionRect$.next(new C.F({height:this.getPixelSize(e.height||0),left:this.getPixelSize(e.left||0),top:this.getPixelSize(e.top||0),width:this.getPixelSize(e.width||0)})):this.selectionRect$.next()}}]),n}(C.s)).\u0275fac=function(e){return new(e||ee)(p["\u0275\u0275inject"](C.e,8))},ee.\u0275prov=p["\u0275\u0275defineInjectable"]({token:ee,factory:ee.\u0275fac}),ee),ce=((Z=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,i,r,o){var s;_classCallCheck(this,n),(s=t.call(this)).changeDetectorRef=i,s.layoutProvider=r,s._control=o,s.selectionChanged=new p.EventEmitter,s.layoutChanged=new p.EventEmitter,s.layoutCompleted=new p.EventEmitter,s.contentAdding=new p.EventEmitter,s.contentRemoving=new p.EventEmitter,s.tilesAdded=new p.EventEmitter,s.tilesDeleted=new p.EventEmitter,s.contentCopied=new p.EventEmitter,s.tabIndex=0,s._models=[],s.hasFocus=!1,s.onTouchedCallback=function(e){},s.onChangeCallback=function(e){},s._control&&(s._control.valueAccessor=_assertThisInitialized(s));var a=e.nativeElement;return Object(B.a)(s.layoutProvider.selectionChanged).pipe(Object(W.a)(s.destroyed$)).subscribe((function(e){return s.selectionChanged.emit(e)})),Object(B.a)(s.layoutProvider.contentAdding).pipe(Object(W.a)(s.destroyed$)).subscribe((function(e){return s.contentAdding.emit(e)})),Object(B.a)(s.layoutProvider.contentRemoving).pipe(Object(W.a)(s.destroyed$)).subscribe((function(e){return s.contentRemoving.emit(e)})),Object(B.a)(s.layoutProvider.tilesAdded).pipe(Object(W.a)(s.destroyed$)).subscribe((function(e){s.tilesAdded.emit(e),s.onChangeCallback(e.tiles)})),Object(B.a)(s.layoutProvider.tilesDeleted).pipe(Object(W.a)(s.destroyed$)).subscribe((function(e){s.tilesDeleted.emit(e),s.onChangeCallback(e.tiles)})),Object(B.a)(s.layoutProvider.layoutChanged).pipe(Object(W.a)(s.destroyed$)).subscribe((function(e){s.layoutChanged.emit(e),s.onChangeCallback(e.tiles)})),Object(B.a)(s.layoutProvider.layoutCompleted).pipe(Object(W.a)(s.destroyed$)).subscribe((function(e){return s.layoutCompleted.emit(e)})),s.keyup$=Object(D.a)(a.ownerDocument,"keyup"),Object(D.a)(window,"resize").pipe(Object(I.a)(5),Object(W.a)(s.destroyed$)).subscribe((function(){return s.refresh({resetWidth:!0})})),s}return _createClass(n,[{key:"writeValue",value:function(e){this._models=e||[],this.layoutProvider.tiles=this._models,this.changeDetectorRef.markForCheck()}},{key:"registerOnChange",value:function(e){this.onChangeCallback=e}},{key:"registerOnTouched",value:function(e){this.onTouchedCallback=e}},{key:"ngAfterViewInit",value:function(){this.layoutProvider.container=this.tilesContainer.nativeElement,this.refresh({resetWidth:!0})}},{key:"ngOnDestroy",value:function(){_get(_getPrototypeOf(n.prototype),"ngOnDestroy",this).call(this),this.canCopy=!1,this.canCut=!1,this.canDelete=!1,this.canPaste=!1}},{key:"copySelection",value:function(){var e,t=this.layoutProvider.copySelection();if(null===(e=t)||void 0===e?void 0:e.length){var n=new CustomEvent("DejaTilesCopied",{cancelable:!0});n.tiles=t,this.contentCopied.emit(n)}}},{key:"cutSelection",value:function(){var e,t=this.layoutProvider.cutSelection();if(null===(e=t)||void 0===e?void 0:e.length){var n=new CustomEvent("DejaTilesCutted",{cancelable:!0});n.tiles=t,this.contentCopied.emit(n)}}},{key:"deleteSelection",value:function(){var e=this.layoutProvider.deleteSelection();return this.changeDetectorRef.markForCheck(),e}},{key:"paste",value:function(){var e=this.layoutProvider.paste();return this.changeDetectorRef.markForCheck(),e}},{key:"ensureVisible",value:function(e){this.layoutProvider.ensureVisible$.next(e)}},{key:"refresh",value:function(e){this.layoutProvider.refreshTiles$.next(e)}},{key:"addTiles",value:function(e){this.layoutProvider.addTiles(e)}},{key:"removeTiles",value:function(e){this.layoutProvider.removeTiles(e)}},{key:"HitTest",value:function(e,t){var n=this.tilesContainer.nativeElement.getBoundingClientRect(),i=e-n.left,r=t-n.top;return this.tiles.find((function(e){var t;return null===(t=e.pixelBounds)||void 0===t?void 0:t.containsPoint(new C.E(i,r))}))}},{key:"getFreePlace",value:function(e,t,n,i){if(!this._models||0===this._models.length)return new C.F(0,0,n,i);var r=this.tilesContainer.nativeElement.getBoundingClientRect(),o=t?t-r.top:0,s=new C.F(this.layoutProvider.getPercentSize(e?e-r.left:0),this.layoutProvider.getPercentSize(o),n,i);return this.layoutProvider.getFreePlace(s)}},{key:"moveTile",value:function(e,t){this.layoutProvider.moveTile(e,t)}},{key:"getDropContext",value:function(){var e=this;return{dragEnter:function(t,n){return e.layoutProvider.dragEnter(t,n)&&{className:"hidden"}},dragOver:function(t,n){e.layoutProvider.dragover$.next(n)},dragLeave:function(t){e.layoutProvider.dragleave$.next()}}}},{key:"onTileClosed",value:function(e){this.layoutProvider.removeTiles([e.id])}},{key:"onFocus",value:function(){this.hasFocus=!0}},{key:"onBlur",value:function(){this.hasFocus=!1}},{key:"tiles",get:function(){return this.layoutProvider.tiles}},{key:"selectionRect$",get:function(){return this.layoutProvider.selectionRect$}},{key:"tileminwidth",set:function(e){this.layoutProvider.tileMinWidth=e}},{key:"tilemaxwidth",set:function(e){this.layoutProvider.tileMaxWidth=e}},{key:"tileminheight",set:function(e){this.layoutProvider.tileMinHeight=e}},{key:"tilemaxheight",set:function(e){this.layoutProvider.tileMaxHeight=e}},{key:"maxwidth",set:function(e){this.layoutProvider.maxWidth=e}},{key:"designMode",set:function(e){this.layoutProvider.designMode=Object(m.b)(e)},get:function(){return this.layoutProvider.designMode}},{key:"models",set:function(e){this.writeValue(e)}},{key:"canDelete",set:function(e){var t=this;Object(m.b)(e)&&!this.delete$sub?this.delete$sub=this.keyup$.pipe(Object(R.a)((function(e){return t.layoutProvider.designMode&&e.code===C.A.Delete&&t.hasFocus})),Object(W.a)(this.destroyed$)).subscribe((function(){return t.layoutProvider.deleteSelection()})):this.delete$sub&&(this.delete$sub.unsubscribe(),this.delete$sub=void 0)}},{key:"canCopy",set:function(e){var t=this;Object(m.b)(e)&&!this.copy$sub?this.copy$sub=this.keyup$.pipe(Object(R.a)((function(e){return e.code===C.A.KeyC&&e.ctrlKey&&t.hasFocus})),Object(W.a)(this.destroyed$)).subscribe((function(){return t.copySelection()})):this.copy$sub&&(this.copy$sub.unsubscribe(),this.copy$sub=void 0)}},{key:"canCut",set:function(e){var t=this;Object(m.b)(e)&&!this.cut$sub?this.cut$sub=this.keyup$.pipe(Object(R.a)((function(e){return t.layoutProvider.designMode&&e.code===C.A.KeyX&&e.ctrlKey&&t.hasFocus})),Object(W.a)(this.destroyed$)).subscribe((function(){return t.cutSelection()})):this.cut$sub&&(this.cut$sub.unsubscribe(),this.cut$sub=void 0)}},{key:"canPaste",set:function(e){var t=this;Object(m.b)(e)&&!this.paste$sub?this.paste$sub=this.keyup$.pipe(Object(R.a)((function(e){return t.layoutProvider.designMode&&e.code===C.A.KeyV&&e.ctrlKey&&t.hasFocus})),Object(W.a)(this.destroyed$)).subscribe((function(){return t.paste()})):this.paste$sub&&(this.paste$sub.unsubscribe(),this.paste$sub=void 0)}},{key:"selectedTiles",set:function(e){this.layoutProvider.selectedTiles=e.map((function(e){return"string"==typeof e?e:e.id}))}}]),n}(C.s)).\u0275fac=function(e){return new(e||Z)(p["\u0275\u0275directiveInject"](p.ElementRef),p["\u0275\u0275directiveInject"](p.ChangeDetectorRef),p["\u0275\u0275directiveInject"](ae),p["\u0275\u0275directiveInject"](r.NgControl,10))},Z.\u0275cmp=p["\u0275\u0275defineComponent"]({type:Z,selectors:[["deja-tiles"]],contentQueries:function(e,t,n){var i;1&e&&p["\u0275\u0275contentQuery"](n,K,!0),2&e&&p["\u0275\u0275queryRefresh"](i=p["\u0275\u0275loadQuery"]())&&(t.tileTemplate=i.first)},viewQuery:function(e,t){var n;1&e&&p["\u0275\u0275staticViewQuery"](G,!0),2&e&&p["\u0275\u0275queryRefresh"](n=p["\u0275\u0275loadQuery"]())&&(t.tilesContainer=n.first)},inputs:{tabIndex:"tabIndex",tileminwidth:"tileminwidth",tilemaxwidth:"tilemaxwidth",tileminheight:"tileminheight",tilemaxheight:"tilemaxheight",maxwidth:"maxwidth",designMode:"designMode",models:"models",canDelete:"canDelete",canCopy:"canCopy",canCut:"canCut",canPaste:"canPaste",selectedTiles:"selectedTiles"},outputs:{selectionChanged:"selectionChanged",layoutChanged:"layoutChanged",layoutCompleted:"layoutCompleted",contentAdding:"contentAdding",contentRemoving:"contentRemoving",tilesAdded:"tilesAdded",tilesDeleted:"tilesDeleted",contentCopied:"contentCopied"},features:[p["\u0275\u0275ProvidersFeature"]([ae]),p["\u0275\u0275InheritDefinitionFeature"]],decls:5,vars:8,consts:[["id","tiles",3,"deja-mouse-droppable","focus","blur"],["tilesContainer",""],[3,"id","tile","designMode","template","close",4,"ngFor","ngForOf"],["deja-tile-position","",3,"bounds"],[3,"id","tile","designMode","template","close"]],template:function(e,t){1&e&&(p["\u0275\u0275elementStart"](0,"div",0,1),p["\u0275\u0275listener"]("focus",(function(){return t.onFocus()}))("blur",(function(){return t.onBlur()})),p["\u0275\u0275template"](2,J,1,5,"deja-tile",2),p["\u0275\u0275element"](3,"div",3),p["\u0275\u0275pipe"](4,"async"),p["\u0275\u0275elementEnd"]()),2&e&&(p["\u0275\u0275classProp"]("design",t.designMode),p["\u0275\u0275property"]("deja-mouse-droppable",t.getDropContext()),p["\u0275\u0275attribute"]("tabindex",t.tabIndex),p["\u0275\u0275advance"](2),p["\u0275\u0275property"]("ngForOf",t.tiles),p["\u0275\u0275advance"](1),p["\u0275\u0275property"]("bounds",p["\u0275\u0275pipeBind1"](4,6,t.selectionRect$)))},directives:[u.d,i.m,re,se],pipes:[i.b],styles:["[_nghost-%COMP%]{position:relative;overflow:auto;margin:0!important}[_nghost-%COMP%]   #tiles[_ngcontent-%COMP%]{display:block;left:0;top:0;width:100%;height:100%;position:absolute;padding:0!important;margin:0!important}[_nghost-%COMP%]   #tiles.design[_ngcontent-%COMP%]   deja-tile[_ngcontent-%COMP%]{background-color:rgba(0,0,0,.1)}[_nghost-%COMP%]   #tiles[_ngcontent-%COMP%]   #tile[_ngcontent-%COMP%]:hover{z-index:200}[_nghost-%COMP%]   [deja-tile-position][_ngcontent-%COMP%]{position:absolute;z-index:101;background-color:rgba(0,0,0,.5)}[drag][_nghost-%COMP%]{background-color:rgba(0,0,0,.5)}[drag][_nghost-%COMP%]   [deja-tile-position][_ngcontent-%COMP%]{transition-property:left,top,width,height;transition-duration:.35s;transition-timing-function:ease}"],changeDetection:0}),Z),le=((Q=function e(){_classCallCheck(this,e)}).\u0275mod=p["\u0275\u0275defineNgModule"]({type:Q}),Q.\u0275inj=p["\u0275\u0275defineInjector"]({factory:function(e){return new(e||Q)},imports:[[i.c,r.FormsModule,u.b,O]]}),Q),de=n("KYkd"),ue=n("iInd"),he=n("Kqap"),fe=n("xbPD"),pe=n("1XgV"),ge=n("iss+");function me(e,t){1&e&&(p["\u0275\u0275elementStart"](0,"mat-card",5),p["\u0275\u0275element"](1,"deja-markdown",6),p["\u0275\u0275elementEnd"]()),2&e&&(p["\u0275\u0275advance"](1),p["\u0275\u0275property"]("url","https://raw.githubusercontent.com/DSI-HUG/dejajs-components/dev/projects/deja-js/component/tiles/readme.txt"))}function ve(e,t){if(1&e){var n=p["\u0275\u0275getCurrentView"]();p["\u0275\u0275elementStart"](0,"button",11),p["\u0275\u0275listener"]("click",(function(){return p["\u0275\u0275restoreView"](n),p["\u0275\u0275nextContext"](2).$implicit.cancel(!1)})),p["\u0275\u0275text"](1," Ok "),p["\u0275\u0275elementEnd"](),p["\u0275\u0275elementStart"](2,"button",12),p["\u0275\u0275listener"]("click",(function(){return p["\u0275\u0275restoreView"](n),p["\u0275\u0275nextContext"](2).$implicit.cancel(!0)})),p["\u0275\u0275text"](3," Annuler "),p["\u0275\u0275elementEnd"]()}}function be(e,t){if(1&e){var n=p["\u0275\u0275getCurrentView"]();p["\u0275\u0275elementStart"](0,"deja-snackbar",8),p["\u0275\u0275listener"]("onAnimationDone",(function(){return p["\u0275\u0275restoreView"](n),p["\u0275\u0275nextContext"]().$implicit.cancel(!1)})),p["\u0275\u0275elementStart"](1,"deja-message-box",9),p["\u0275\u0275text"](2),p["\u0275\u0275template"](3,ve,4,0,"ng-template",null,10,p["\u0275\u0275templateRefExtractor"]),p["\u0275\u0275elementEnd"](),p["\u0275\u0275elementEnd"]()}if(2&e){var i=p["\u0275\u0275nextContext"]().$implicit;p["\u0275\u0275property"]("duration",8e3),p["\u0275\u0275advance"](1),p["\u0275\u0275propertyInterpolate"]("type",i.type),p["\u0275\u0275propertyInterpolate"]("title",i.title),p["\u0275\u0275advance"](1),p["\u0275\u0275textInterpolate1"](" ",i.content," ")}}function ye(e,t){1&e&&p["\u0275\u0275template"](0,be,5,4,"deja-snackbar",7),2&e&&p["\u0275\u0275property"]("ngIf",t.$implicit.gate)}function xe(e,t){if(1&e&&(p["\u0275\u0275elementStart"](0,"div",23),p["\u0275\u0275text"](1),p["\u0275\u0275elementStart"](2,"span",24),p["\u0275\u0275text"](3,"Selected"),p["\u0275\u0275elementEnd"](),p["\u0275\u0275elementStart"](4,"span",25),p["\u0275\u0275text"](5,"Pressed"),p["\u0275\u0275elementEnd"](),p["\u0275\u0275elementEnd"]()),2&e){var n=t.$implicit;p["\u0275\u0275styleProp"]("background-color",n.color),p["\u0275\u0275advance"](1),p["\u0275\u0275textInterpolate2"]("",n.templateModel.naqme," (",n.templateModel.code,") ")}}function ke(e,t){if(1&e&&(p["\u0275\u0275elementStart"](0,"div",23),p["\u0275\u0275text"](1),p["\u0275\u0275elementStart"](2,"span",24),p["\u0275\u0275text"](3,"Selected"),p["\u0275\u0275elementEnd"](),p["\u0275\u0275elementStart"](4,"span",25),p["\u0275\u0275text"](5,"Pressed"),p["\u0275\u0275elementEnd"](),p["\u0275\u0275elementEnd"]()),2&e){var n=t.$implicit;p["\u0275\u0275styleProp"]("background-color",n.color),p["\u0275\u0275advance"](1),p["\u0275\u0275textInterpolate2"]("",n.templateModel.naqme," (",n.templateModel.code,") ")}}function we(e,t){if(1&e){var n=p["\u0275\u0275getCurrentView"]();p["\u0275\u0275elementStart"](0,"mat-card",5),p["\u0275\u0275elementStart"](1,"mat-toolbar",13),p["\u0275\u0275text"](2,"Tiles Demo"),p["\u0275\u0275elementEnd"](),p["\u0275\u0275elementStart"](3,"mat-card-content",14),p["\u0275\u0275elementStart"](4,"mat-checkbox",15),p["\u0275\u0275listener"]("ngModelChange",(function(e){return p["\u0275\u0275restoreView"](n),p["\u0275\u0275nextContext"]().designMode=e})),p["\u0275\u0275text"](5,"Design Mode"),p["\u0275\u0275elementEnd"](),p["\u0275\u0275elementEnd"](),p["\u0275\u0275elementStart"](6,"mat-card-content"),p["\u0275\u0275elementStart"](7,"span",16,17),p["\u0275\u0275text"](9," Drop Area "),p["\u0275\u0275elementEnd"](),p["\u0275\u0275elementEnd"](),p["\u0275\u0275elementStart"](10,"mat-card-content"),p["\u0275\u0275elementStart"](11,"deja-tiles",18,19),p["\u0275\u0275listener"]("contentAdding",(function(e){return p["\u0275\u0275restoreView"](n),p["\u0275\u0275nextContext"]().onContentAdding(e)}))("contentRemoving",(function(e){return p["\u0275\u0275restoreView"](n),p["\u0275\u0275nextContext"]().onContentRemoving(e)})),p["\u0275\u0275pipe"](13,"async"),p["\u0275\u0275template"](14,xe,6,4,"ng-template",null,20,p["\u0275\u0275templateRefExtractor"]),p["\u0275\u0275elementEnd"](),p["\u0275\u0275elementEnd"](),p["\u0275\u0275elementStart"](16,"mat-card-content"),p["\u0275\u0275elementStart"](17,"deja-tiles",21,22),p["\u0275\u0275listener"]("contentAdding",(function(e){return p["\u0275\u0275restoreView"](n),p["\u0275\u0275nextContext"]().onContentAdding(e)}))("contentRemoving",(function(e){return p["\u0275\u0275restoreView"](n),p["\u0275\u0275nextContext"]().onContentRemoving(e)})),p["\u0275\u0275pipe"](19,"async"),p["\u0275\u0275template"](20,ke,6,4,"ng-template",null,20,p["\u0275\u0275templateRefExtractor"]),p["\u0275\u0275elementEnd"](),p["\u0275\u0275elementEnd"](),p["\u0275\u0275elementEnd"]()}if(2&e){var i=p["\u0275\u0275reference"](8),r=p["\u0275\u0275nextContext"]();p["\u0275\u0275advance"](4),p["\u0275\u0275property"]("ngModel",r.designMode),p["\u0275\u0275advance"](3),p["\u0275\u0275property"]("deja-mouse-droppable",r.getDropContext(i)),p["\u0275\u0275advance"](4),p["\u0275\u0275property"]("models",p["\u0275\u0275pipeBind1"](13,6,r.tiles1$))("deja-mouse-draggable",r.getDragContext()),p["\u0275\u0275advance"](6),p["\u0275\u0275property"]("models",p["\u0275\u0275pipeBind1"](19,8,r.tiles2$))("designMode",r.designMode)}}var _e,je=ue.f.forChild([{path:"",component:(_e=function(){function e(t){_classCallCheck(this,e),this.countriesService=t,this.tabIndex=1,this.designMode=!1,this.message$=new E.a,this.messages$=Object(B.a)(this.message$).pipe(Object(he.a)((function(e,t){return[].concat(_toConsumableArray(e),[t])}),[]),Object(fe.a)([]))}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this,t=0,n=0,i=0,r=0;this.countriesMap=new Map;var o=this.countriesService.getCountries$().pipe(Object(V.a)((function(e){return e})));this.tiles1$=o.pipe(Object(U.a)(12),Object(H.a)((function(i){var r=new oe;return r.percentBounds=new C.F(t,n,15,15),r.color=i.color,r.templateModel=i,(t+=15)+15>100&&(t=0,n+=15),e.countriesMap.set(r.id,i),r})),Object(X.a)((function(e,t){return[].concat(_toConsumableArray(e),[t])}),[])),this.tiles2$=o.pipe(Object(H.a)((function(e){var t=new oe;return t.percentBounds=new C.F(i,r,15,15),t.color=e.color,t.templateModel=e,(i+=15)+15>100&&(i=0,r+=15),t})),Object(X.a)((function(e,t){return[].concat(_toConsumableArray(e),[t])}),[]))}},{key:"getDragContext",value:function(){var e=this;return{target:"deja-tile",className:"deja-tile-cursor",dragStart:function(t){var n=e.countriesMap.get(t.id),i=new oe;return i.percentBounds=new C.F(0,0,15,15),i.color=n.color,i.templateModel=n,{country:n,DejaTile:i}}}}},{key:"getDropContext",value:function(e){return{dragEnter:function(e){return{width:200,height:60,className:"country-target-cursor"}},drop:function(t){var n=t.country;e.innerText="The dropped country is ".concat(n.naqme," - the code is: ").concat(n.code)}}}},{key:"onContentAdding",value:function(e){this.message$.next({title:"Tiles added",content:e.added.length+" tiles added.",type:"warn",gate:!0,cancel:function(t){this.gate=!1,e.cancel$.next(t)}}),e.preventDefault()}},{key:"onContentRemoving",value:function(e){this.message$.next({title:"Tiles deleted",content:e.removed.length+" tiles deleted.",type:"warn",gate:!0,cancel:function(t){this.gate=!1,e.cancel$.next(t)}}),e.preventDefault()}}]),e}(),_e.\u0275fac=function(e){return new(e||_e)(p["\u0275\u0275directiveInject"](pe.a))},_e.\u0275cmp=p["\u0275\u0275defineComponent"]({type:_e,selectors:[["deja-tiles-demo"]],decls:8,vars:6,consts:[[3,"selectedIndex","selectedTabChange"],["label","API REFERENCE"],["label","EXAMPLES"],["class","demo-card demo-basic",4,"ngIf"],["ngFor","",3,"ngForOf"],[1,"demo-card","demo-basic"],[3,"url"],["alignment","bottom right",3,"duration","onAnimationDone",4,"ngIf"],["alignment","bottom right",3,"duration","onAnimationDone"],[3,"type","title"],["actionsTemplate",""],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","",3,"click"],["color","primary"],["id","actions"],[3,"ngModel","ngModelChange"],["id","droparea",3,"deja-mouse-droppable"],["dropArea",""],["id","tiles1","maxwidth","100%","tileminwidth","5%","tileminheight","5%","tilemaxheight","50%","tilemaxwidth","50%",3,"models","deja-mouse-draggable","contentAdding","contentRemoving"],["tiles1",""],["tileTemplate",""],["id","tiles2","canDelete","","canCopy","","canCut","","canPaste","","maxwidth","100%","tileminwidth","5%","tileminheight","5%","tilemaxheight","50%","tilemaxwidth","50%",3,"models","designMode","contentAdding","contentRemoving"],["tiles2",""],[1,"tile-content","noselect"],["id","selected"],["id","pressed"]],template:function(e,t){1&e&&(p["\u0275\u0275elementStart"](0,"mat-tab-group",0),p["\u0275\u0275listener"]("selectedTabChange",(function(e){return t.tabIndex=e.index})),p["\u0275\u0275element"](1,"mat-tab",1),p["\u0275\u0275element"](2,"mat-tab",2),p["\u0275\u0275elementEnd"](),p["\u0275\u0275template"](3,me,2,1,"mat-card",3),p["\u0275\u0275template"](4,ye,1,1,"ng-template",4),p["\u0275\u0275pipe"](5,"async"),p["\u0275\u0275template"](6,we,22,10,"mat-card",3),p["\u0275\u0275element"](7,"deja-mouse-dragdrop-cursor")),2&e&&(p["\u0275\u0275property"]("selectedIndex",t.tabIndex),p["\u0275\u0275advance"](3),p["\u0275\u0275property"]("ngIf",0===t.tabIndex),p["\u0275\u0275advance"](1),p["\u0275\u0275property"]("ngForOf",p["\u0275\u0275pipeBind1"](5,4,t.messages$)),p["\u0275\u0275advance"](2),p["\u0275\u0275property"]("ngIf",1===t.tabIndex))},directives:[c.b,c.a,i.n,i.m,u.a,s.a,ge.a,h.a,d.a,o.b,l.a,s.c,a.a,r.NgControlStatus,r.NgModel,u.d,ce,u.c],pipes:[i.b],styles:["deja-tiles-demo .demo-basic{padding:0}deja-tiles-demo .demo-full-width{width:100%}deja-tiles-demo .demo-icons{font-size:100%;height:inherit;vertical-align:top;width:inherit}deja-tiles-demo .demo-card{margin:16px}deja-tiles-demo .demo-card mat-card-content{display:flex;flex-direction:column;margin:2rem}deja-tiles-demo #actions{display:flex;flex-direction:row;align-items:center;justify-content:space-between}deja-tiles-demo #droparea{height:5rem;background-color:#f57c00;width:50%;display:block}deja-tiles-demo #tiles1{height:370px;display:block}deja-tiles-demo #tiles2{height:1000px;display:block}deja-tiles-demo deja-tile{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}deja-tiles-demo deja-tile #pressed,deja-tiles-demo deja-tile #selected{display:none}deja-tiles-demo deja-tile[pressed] #pressed,deja-tiles-demo deja-tile[selected] #selected{display:block}deja-tiles-demo deja-tile .tile-content{width:100%;height:100%;display:block}@media screen and (min-width:1401px){deja-tiles-demo deja-tiles{font-size:100%}}@media screen and (max-width:1400px){deja-tiles-demo deja-tiles{font-size:90%}}@media screen and (max-width:1200px){deja-tiles-demo deja-tiles{font-size:85%}}@media screen and (max-width:768px){deja-tiles-demo deja-tiles{font-size:80%}}@media screen and (max-width:640px){deja-tiles-demo deja-tiles{font-size:70%}}@media screen and (max-width:320px){deja-tiles-demo deja-tiles{font-size:60%}}.country-target-cursor .tile-content,.deja-tile-cursor .tile-content{width:100%;height:100%;display:block;opacity:.8}.country-target-cursor .tile-content{background-color:#f4a460!important}"],encapsulation:2}),_e)},{path:"**",redirectTo:"",pathMatch:"full"}]);n.d(t,"DejaTilesDemoModule",(function(){return Oe}));var Me,Oe=((Me=function e(){_classCallCheck(this,e)}).\u0275mod=p["\u0275\u0275defineNgModule"]({type:Me}),Me.\u0275inj=p["\u0275\u0275defineInjector"]({factory:function(e){return new(e||Me)},providers:[],imports:[[i.c,r.FormsModule,s.d,c.c,l.b,o.c,a.b,le,de.a,h.b,u.b,d.b,je]]}),Me)}}]);